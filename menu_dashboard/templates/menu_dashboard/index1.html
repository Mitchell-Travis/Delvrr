
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Delvrr">
    <meta name="theme-color" content="#FFC107">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- SEO Meta Tags -->
    <meta name="description"
          content="{{ og_description|default:'Scan the QR code to access the digital menu of your favorite restaurant. Browse dishes, place orders, and enjoy a seamless dining experience with Delvrr.' }}">
    <meta name="keywords"
          content="QR code menu, digital menu, restaurant ordering, contactless dining, online food menu, mobile ordering, food delivery">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type"        content="website">
    <meta property="og:site_name"   content="Delvrr">
    <meta property="og:title"       content="{{ og_title|default:'Delvrr - QR Code Digital Menu' }}">
    <meta property="og:description" content="{{ og_description|default:'Scan and browse the restaurant’s digital menu instantly. A seamless way to order your favorite dishes.' }}">
    <meta property="og:image"       content="{{ logo_url }}">
    <meta property="og:image:alt"   content="{{ og_title|default:'Restaurant logo' }}">
    <meta property="og:url"         content="{{ canonical_url }}">
    <meta property="og:locale"      content="en_US">

    <!-- Twitter -->
    <meta name="twitter:card"        content="summary_large_image">
    <meta name="twitter:site"        content="@delvrrapp">
    <meta name="twitter:creator"     content="@delvrrapp">
    <meta name="twitter:title"       content="{{ og_title|default:'Delvrr - QR Code Digital Menu' }}">
    <meta name="twitter:description" content="{{ og_description|default:'Scan and browse the restaurant’s digital menu instantly.' }}">
    <meta name="twitter:image"       content="{{ logo_url }}">
    <meta name="twitter:image:alt"   content="{{ og_title|default:'Restaurant logo' }}">

    <!-- Pinterest -->
    <meta name="pinterest-rich-pin" content="true">

    <!-- LinkedIn -->
    <meta property="linkedin:owner" content="Delvrr">

    <!-- WhatsApp / SMS Preview -->
    <meta property="og:site_name" content="Delvrr">

    <title>{{ og_title|default:'Delvrr - QR Code Digital Menu' }}</title>

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ canonical_url }}">

    <!-- Preload first product image if available -->
    {% if allProds.0.0.product_image %}
    <link rel="preload" as="image" href="{{ allProds.0.0.product_image.url }}">
    {% endif %}

    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/x-icon"
          href="{% static 'menu_dashboard/images/favicon/favicon.ico' %}">
    <link rel="apple-touch-icon" sizes="180x180"
          href="{% static 'menu_dashboard/images/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32"
          href="{% static 'menu_dashboard/images/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16"
          href="{% static 'menu_dashboard/images/favicon/favicon-16x16.png' %}">
    <link rel="manifest"
          href="{% static 'menu_dashboard/images/favicon/site.webmanifest' %}">

    
    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../../../static/menu_dashboard/libs/bootstrap-icons/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../../static/menu_dashboard/libs/feather-webfont/dist/feather-icons.css">
    <link rel="stylesheet" href="../../../static/menu_dashboard/libs/simplebar/dist/simplebar.min.css">
    <link rel="stylesheet" href="../../../static/menu_dashboard/css/style.css">
    <link rel="stylesheet" href="../../../static/menu_dashboard/css/theme.min.css">
    <link rel="stylesheet" href="{% static 'menu_dashboard/css/menu.css' %}">
    <style>
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath stroke='rgba(88, 88, 88, 0.7)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
        }
    </style>
    
    <!-- Preconnect to CDNs for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Restaurant",
      "name": "Delvrr Digital Menu",
      "description": "Scan the QR code to view the restaurant's menu and place orders easily.",
      "url": "https://delvrr.com/",
      "image": "https://delvrr.com/media/preview.jpg",
      "logo": "https://delvrr.com/media/Delvrr-logo.JPG",
      "servesCuisine": "Multiple Cuisines",
      "telephone": "0881163840",
      "hasMenu": {
        "@type": "Menu",
        "name": "Digital Menu",
        "url": "https://delvrr.com/"
      },
      "sameAs": [
        "https://web.facebook.com/profile.php?id=61566341983829",
      ]
    }
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VX73T7NVLB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VX73T7NVLB');
    </script>


    <style type="text/css">
:root {
    /* Color Palette */
    --brand: #f7c028;
    --brand-dark: #d6a021; /* Slightly darker than #f7c028 */
    --brand-light: rgba(247, 192, 40, 0.1);
    --background: #ffffff;
    --surface: #f8f9fa;
    --text-primary: #1a1a1a;
    --text-secondary: #6c757d;
    --border: #e9ecef;
    --primary-color: #f7c028;
    
    /* New Transition Variable for Smooth Animations */
    --transition: all 0.3s ease-out;

    /* Typography */
    --font-family: 'Poppins', sans-serif;

    /* Sizing and Spacing */
    --radius-lg: 20px;
    --radius-md: 12px;
    --radius-sm: 8px;
    --border-radius: 12px;
    
    /* Shadows */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
}

/* Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-family);
    /* Make the background solid white (instead of a gradient) */
    background: #ffffff;
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    padding-bottom: 84px;
}

/* Modal Styles */
.modal-content {
    border-radius: var(--radius-lg);
    border: none;
    background-image: url('../../../static/menu_dashboard/images/');
    background-size: cover;
    background-position: center;
    position: relative;
    box-shadow: var(--shadow-md);
    transition: var(--transition);
}

.modal-overlay {
    background: var(--background);
    padding: 20px;
    border-radius: var(--radius-md);
    position: relative;
    z-index: 2;
}

.modal-body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.modal-dialog {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.modal-backdrop {
    background-color: rgba(0, 0, 0, 0.8);
}

/* Button Styles */
.btn-outline-secondary {
    border-radius: 20px;
}

.btn-primary {
    border-radius: 10px;
}

.btn-close-custom {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
}

.btn-close-custom:hover {
    background: #fff;
    transform: scale(1.1);
}

.btn-close-custom i {
    font-size: 14px;
    color: #666;
}

/* Typography and Branding */
.delvrr-logo {
    font-size: 1.8rem;
    font-weight: bold;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-family: 'Arial', sans-serif;
}

.payment-text {
    font-size: 18px;
    display: inline-block;
    width: 90px;
    text-align: center;
    letter-spacing: 0.1em;
}

/* Notification Styles */
.toast-container {
    z-index: 1055;
}

.toast.text-bg-warning {
    background-color: var(--brand);
    color: var(--background);
}

.toast .btn-close-white {
    filter: invert(1);
}

/* App Container */
.menu-app-container {
    max-width: 480px;
    margin: 0 auto;
    background: var(--background);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Modern App Header */
:root {
  /* Use the existing primary brand color */
  --primary-color: {{ primary_brand_color }};
  --secondary-color: {{ secondary_brand_color }};
  
  /* Define a consistent design system */
  --background: #ffffff;
  --text-primary: #222222;
  --text-secondary: #6e6e6e;
  --light-bg: #f7f7f7;
  --border-color: rgba(0, 0, 0, 0.08);
  --success-color: #4CAF50;
  --warning-color: #FFC107;
  --danger-color: #F44336;
  
  /* Elevation/shadows */
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 6px 16px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 12px 24px rgba(0, 0, 0, 0.15);
  
  /* Spacing scale */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  
  /* Border radius */
  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-lg: 20px;
  --radius-pill: 9999px;
}

/* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  color: var(--text-primary);
  background-color: var(--light-bg);
  -webkit-tap-highlight-color: transparent;
  overflow-x: hidden;
}

/* ======== Header Component ======== */
.aliexpress-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: {{ primary_brand_color }};
  padding: var(--space-md) var(--space-md);
  box-shadow: var(--shadow-md);
  position: relative;
  z-index: 19;
  
}

/* Group the hamburger menu and brand info on the left */
.header-left {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}

.filter-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 42px;
  height: 42px;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 
              inset 0 1px 1px rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* Hover effect */
.filter-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 
              inset 0 1px 1px rgba(255, 255, 255, 0.3);
}

/* Active/click state */
.filter-button:active {
  transform: translateY(1px) scale(0.96);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1),
              inset 0 1px 1px rgba(255, 255, 255, 0.1);
}

/* Icon styling */
.filter-button i {
  font-size: 18px;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  transition: transform 0.2s ease;
}

/* Brand styling */
.brand-info {
  display: flex;
  flex-direction: column;
}

.logo {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  line-height: 1.1;
  letter-spacing: -0.5px;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.restaurant-name-container {
  display: flex;
  align-items: center;
  margin-top: var(--space-xs);
  background-color: rgba(255, 255, 255, 0.15);
  border-radius: var(--radius-pill);
  padding: 4px 12px;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.location-icon {
  font-size: 10px;
  color: #fff;
  margin-right: var(--space-xs);
}

.restaurant-name {
  font-size: 12px;
  color: white;
  margin: 0;
  font-weight: 500;
}

/* Right side: container for the restaurant logo */
.header-icons {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}

.action-button {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.1);
  width: 38px;
  height: 38px;
  border-radius: 12px;
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.action-button:active {
  transform: scale(0.95);
  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
}

.restaurant-logo {
  width: 46px;
  height: 46px;
  border-radius: 14px;
  object-fit: cover;
  border: 2px solid rgba(255, 255, 255, 0.8);
  box-shadow: var(--shadow-md);
}

/* ======== Search Section ======== */
.search-header {
  width: 100%;
  background-color: var(--background);
  padding: var(--space-md);
  margin-top: 0px;
  position: relative;
  z-index: 19;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  box-shadow: var(--shadow-sm);
}

.search-container {
  width: 100%;
  background-color: var(--light-bg);
  border-radius: var(--radius-pill);
  display: flex;
  align-items: center;
  padding: 12px 20px;
  position: relative;
  border: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.search-icon {
  font-size: 18px;
  color: var(--text-secondary);
  margin-right: var(--space-sm);
}

.search-input {
  flex: 1;
  border: none;
  background: transparent;
  outline: none;
  font-size: 16px;
  padding: 0;
  color: var(--text-primary);
}

.search-input::placeholder {
  color: var(--text-secondary);
}

.search-results-dropdown {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  right: 0;
  background: var(--background);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  z-index: 999;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

/* PROMO BANNER - Modern, App-like */
.promo-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1200px;
    min-height: 80px;
    margin: 32px auto;
    padding: 16px 20px;
    position: relative;
    background: #f5f5f5;
    color: #fff;
    border-radius: 0px;
    overflow: hidden;
}

/* Promo Text Content */
.promo-content {
    max-width: 55%;
}

.promo-content h2 {
    font-size: 1.5rem;
    margin-bottom: 8px;
    font-weight: 700;
    line-height: 1.2;
}

.promo-content p {
    font-size: 1rem;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1.4;
}

/* Call-to-Action Button */
.promo-cta {
    background: rgba(255, 255, 255, 0.2);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.promo-cta:hover {
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.3);
}

.promo-cta:active {
    transform: translateY(0);
    opacity: 0.9;
}

/* SVG Container with Placeholder SVG */
.promo-svg-container {
    flex-shrink: 0;
    max-width: 35%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.promo-svg-container svg {
    width: 60px;
    height: auto;
    stroke: #fff;
}

/* Media Queries for Responsive Design */
@media (max-width: 768px) {
    .app-header {
        padding: 12px;
    }
    
    .header-content h1 {
        font-size: 20px;
    }
    
    .icon-button {
        width: 38px;
        height: 38px;
        border-radius: 10px;
    }

    .promo-banner {
        margin: 24px auto;
        flex-direction: column;
        text-align: center;
        padding: 12px;
        min-height: 60px;
    }
    
    .promo-content {
        max-width: 100%;
    }
    
    .promo-content h2 {
        font-size: 1.25rem;
    }
    
    .promo-content p {
        font-size: 0.875rem;
    }
    
    .promo-svg-container {
        max-width: 50%;
        margin-top: 8px;
    }
}


/* Search Header */
.search-header {
    padding: 16px;
    background-color: white;
    display: flex;
    justify-content: center;
}

.search-wrapper {
    display: flex;
    align-items: center;
    width: 90%;
    max-width: 600px;
}

.search-container {
    display: flex;
    align-items: center;
    background: #f5f5f5;
    border-radius: 100px;  /* Increased border radius for pill shape */
    padding: 12px 20px;
    flex-grow: 1;
    box-shadow: none;
}

.search-icon {
    color: #9ca3af;
    margin-right: 12px;
    font-size: 20px;
}

.search-input {
    border: none;
    background: transparent;
    outline: none;
    width: 100%;
    font-size: 16px;
    color: #333;
    font-weight: 400;
}

.search-input::placeholder {
    color: #9ca3af;
    font-weight: 400;
}

/* Search component styles */
.search-header {
  position: relative;
  z-index: 1002;
}

.search-wrapper {
  position: relative;
  width: 100%;
  z-index: 1002;
}

.search-container {
  position: relative;
  width: 100%;
}

.search-results-dropdown {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  width: 350px; /* or any width you prefer */
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-height: 300px;
  overflow-y: auto;
  z-index: 1002;
  margin-top: 4px;
}

.search-results-content {
  padding: 5px 0;
}

.search-result-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.search-result-item:hover {
  background-color: #f5f5f5;
}

.search-result-image {
  width: 48px;
  height: 48px;
  border-radius: 6px;
  object-fit: contain;
  margin-right: 12px;
  padding: 4px; /* Adds some padding inside the image container */
  background-color: #f5f5f5;
}

.search-result-info {
  flex: 1;
}

.search-result-name {
  font-weight: 500;
  margin-bottom: 4px;
}

.search-result-category {
  font-size: 0.85em;
  color: #666;
}

.no-results-message {
  padding: 16px;
  text-align: center;
  color: #666;
}

/* Category Navigation */
.category-nav {
  position: relative;
  z-index: 1;
}

/* Header */
.app-header {
  position: relative;
  z-index: 1;
}

/* Menu Container */
.menu-app-container {
  position: relative;
}

/* Category Navigation */
/* ======== Category Navigation ======== */
/* ======== Category Navigation ======== */
.category-nav {
  position: sticky;
  top: 0;
  z-index: 18;
  padding: 6px 0; /* Significantly reduced padding top and bottom */
  background: var(--background);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  width: 100%;
  border-bottom: 1px solid var(--border-color);
}
.category-scroll {
  display: flex;
  overflow-x: auto;
  gap: 10px; /* Reduced gap */
  padding: 2px 16px; /* Reduced vertical padding */
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  scrollbar-width: none;
  mask-image: linear-gradient(to right, transparent, black 4%, black 96%, transparent);
  -webkit-mask-image: linear-gradient(to right, transparent, black 4%, black 96%, transparent);
}
.category-scroll::-webkit-scrollbar {
  display: none;
}
/* Category buttons */
/* Category buttons */
.category-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 12px; /* Slightly smaller font */
  font-weight: 600;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 4px 10px; /* Reduced padding */
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
  position: relative;
  min-width: 70px; /* Smaller min-width */
  max-width: 90px; /* Smaller max-width */
  outline: none;
  flex: 0 0 auto;
  touch-action: manipulation;
}

.category-btn:hover {
  color: var(--secondary-color);
}

.category-btn:active {
  transform: scale(0.95);
}

/* Icon styling */
.category-icon {
  font-size: 20px; /* Smaller icons */
  margin-bottom: 3px; /* Minimal margin */
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 40px; /* Significantly smaller height */
  width: 40px; /* Significantly smaller width */
  border-radius: 12px;
  background-color: var(--light-bg);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}

/* Active state */
.category-btn.active {
  color: var(--secondary-color) !important; /* Added !important to ensure it applies on all screen sizes */
  font-weight: 700;
}

.category-btn.active .category-icon {
  background: linear-gradient(135deg, var(--secondary-color), color-mix(in srgb, var(--secondary-color) 80%, white));
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  transform: translateY(-4px);
}

/* Fixed active indicator */
.category-btn::after {
  content: "";
  display: block;
  width: 0;
  height: 3px; /* Thinner indicator */
  background: var(--secondary-color);
  border-radius: 4px;
  margin-top: 3px; /* Less margin */
  opacity: 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.category-btn.active::after {
  width: 50%;
  opacity: 1;
}

/* Media query fix for mobile/smaller screens */
@media (max-width: 768px) {
  .category-btn.active {
    color: var(--secondary-color);
  }
  
  .category-btn.active::after {
    background: var(--secondary-color);
  }
}

/* Additional responsive fixes */
@media (max-width: 480px) {
  .category-btn.active {
    color: var(--secondary-color);
  }
  
  .category-nav {
    padding: 4px 0;
  }
  
  .category-scroll {
    gap: 8px;
  }
}

/* Force icon background to use the secondary color on all devices */
.category-btn.active .category-icon {
  background: linear-gradient(135deg, var(--secondary-color), color-mix(in srgb, var(--secondary-color) 80%, white)) !important;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15) !important;
  transform: translateY(-4px) !important;
}

/* Mobile-specific overrides with higher specificity */
@media screen and (max-width: 767px) {
  .category-nav .category-scroll .category-btn.active .category-icon {
    background: linear-gradient(135deg, var(--secondary-color), color-mix(in srgb, var(--secondary-color) 80%, white)) !important;
    background-color: var(--secondary-color) !important; /* Fallback */
  }
  
  /* Increased specificity for the icons */
  body .category-nav .category-scroll .category-btn.active .category-icon {
    background: linear-gradient(135deg, var(--secondary-color), color-mix(in srgb, var(--secondary-color) 80%, white)) !important;
    background-color: var(--secondary-color) !important; /* Fallback */
  }
  
  /* Alternative background for browsers that don't support color-mix */
  @supports not (background: color-mix(in srgb, var(--secondary-color) 80%, white)) {
    .category-nav .category-scroll .category-btn.active .category-icon {
      background: var(--secondary-color) !important;
    }
  }
}

/* Additional fixes for different devices/platforms */
@media screen and (max-width: 480px) {
  /* iOS-specific styles */
  @supports (-webkit-touch-callout: none) {
    .category-btn.active .category-icon {
      background-color: var(--secondary-color) !important;
      background-image: none !important;
    }
  }
  
  /* Fallback for older browsers */
  .category-btn.active .category-icon {
    background-color: var(--secondary-color) !important;
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

/* ======== Featured Items Section ======== */
/* ======== Featured Items Section ======== */
.featured-section {
  padding: var(--space-md) var(--space-md) var(--space-lg);
  background-color: var(--background);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  margin-top: -8px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-md);
}

.section-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
}

.view-all {
  font-size: 14px;
  color: var(--secondary-color);
  background: none;
  border: none;
  font-weight: 600;
  cursor: pointer;
  padding: 6px 12px;
  border-radius: var(--radius-pill);
  transition: all 0.2s ease;
}

.view-all:hover {
  background-color: rgba(var(--secondary-color-rgb), 0.1);
}

.items-carousel {
  display: flex;
  gap: var(--space-md);
  overflow-x: auto;
  padding-bottom: var(--space-md);
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  padding-left: 4px;
  padding-right: 4px;
  margin-left: -4px;
  margin-right: -4px;
}

.items-carousel::-webkit-scrollbar {
  display: none;
}

.food-item {
  flex: 0 0 auto;
  width: 180px;
  background-color: var(--background);
  border-radius: var(--radius-sm);
  overflow: hidden;
  transition: all 0.3s ease;
  transform: translateZ(0);
  will-change: transform;
}

.food-item:hover {
  transform: translateY(-4px);
  
}

.food-item:active {
  transform: scale(0.98);
}

.food-image-container {
  position: relative;
  height: 140px;
  overflow: hidden;
}

.food-image {
  width: 100%;
  height: 100%;
  background-color: var(--light-bg);
  transition: transform 0.3s ease;
}



/* New inner container for white background without rounded corners */
.food-image-inner {
  width: 100%;
  height: 100%;
  background-color: white;  /* Change if needed */
  border-radius: 0;
  overflow: hidden;
}

.food-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
  border: none;
  outline: none;
}

.food-item:hover .food-image img {
  transform: scale(1.05);
}

.discount-badge {
  position: absolute;
  top: var(--space-sm);
  left: var(--space-sm);
  background-color: var(--danger-color);
  color: white;
  font-size: 11px;
  font-weight: bold;
  padding: 4px 8px;
  border-radius: var(--radius-pill);
  z-index: 2;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.food-details {
  padding: var(--space-md);
}

.food-details h3 {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-primary);
}

.rating {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-bottom: var(--space-sm);
  font-size: 13px;
}

.rating i {
  color: var(--warning-color);
}

.review-count {
  color: var(--text-secondary);
}

.price-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.price {
  font-weight: 700;
  color: var(--text-primary);
  font-size: 16px;
}

.add-to-cart {
  width: 32px;
  height: 32px;
  border-radius: 10px;
  background-color: transparent;
  color: #000000;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s ease;
}

.add-to-cart:hover {
  transform: translateY(-2px);
  color: #555555;
}

.add-to-cart:active {
  transform: scale(0.9);
}

.add-to-cart i {
  font-size: 18px;
}

/* ======== View All Grid Section ======== */
.product-grid-container {
  padding: var(--space-md) var(--space-md) var(--space-lg);
  background-color: var(--background);
  display: none; /* Hidden by default, shown when View All is clicked */
  animation: fadeIn 0.3s ease-in;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-lg);
  width: 100%;
}

.grid-item {
  background-color: var(--background);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: all 0.3s ease;
}

.grid-item:active {
  transform: scale(0.98);
}

.grid-image-container {
  position: relative;
  height: 160px;
  overflow: hidden;
}

.grid-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.grid-item:hover .grid-image {
  transform: scale(1.05);
}

.grid-details {
  padding: var(--space-md);
}

.grid-details h3 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: var(--space-xs);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  min-height: 42px;
  line-height: 1.4;
}

.grid-details .description {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  min-height: 36px;
  line-height: 1.4;
}

.grid-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: var(--space-sm);
}

.back-to-carousel {
  display: inline-flex;
  font-size: 14px;
  color: var(--secondary-color);
  background: none;
  border: none;
  font-weight: 600;
  cursor: pointer;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  border-radius: var(--radius-pill);
  transition: all 0.2s ease;
}

.back-to-carousel:hover {
  background-color: rgba(var(--secondary-color-rgb), 0.1);
}

.back-to-carousel i {
  font-size: 12px;
}

.category-badge {
  display: inline-block;
  background-color: var(--light-bg);
  color: var(--text-secondary);
  font-size: 11px;
  padding: 4px 10px;
  border-radius: var(--radius-pill);
  margin-bottom: var(--space-xs);
  font-weight: 500;
}

/* Animation for view transitions */
.fade-in {
  animation: fadeIn 0.3s ease-in;
}

.fade-out {
  animation: fadeOut 0.3s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(10px); }
}

/* Add to cart animation */
.add-to-cart.added {
  background-color: var(--success-color);
  animation: addedPulse 0.5s ease;
}

@keyframes addedPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

/* Custom scrollbar for webkit browsers */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 10px;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  :root {
    --background: #121212;
    --text-primary: #f0f0f0;
    --text-secondary: #a0a0a0;
    --light-bg: #202020;
    --border-color: rgba(255, 255, 255, 0.1);
  }
  
  .category-icon {
    background-color: rgba(255, 255, 255, 0.08);
  }
  
  .food-image {
    background-image: linear-gradient(45deg, var(--light-bg), #2a2a2a);
  }
  
  .search-container {
    border-color: rgba(255, 255, 255, 0.05);
  }
  
  .grid-image {
    background-image: linear-gradient(45deg, var(--light-bg), #2a2a2a);
  }
  
  .category-badge {
    background-color: rgba(255, 255, 255, 0.08);
  }
  
  .food-item, .grid-item {
    border: 1px solid rgba(255, 255, 255, 0.08);
  }
}

/* Add CSS variables for RGB values of secondary color */
:root {
  --secondary-color-rgb: 0, 120, 212; /* Default fallback - replace with actual color in JS */
}

/* Responsive adjustments */
@media (max-width: 480px) {
  .product-grid {
    gap: var(--space-md);
  }
  
  .grid-image-container {
    height: 130px;
  }
  
  .grid-details {
    padding: var(--space-sm);
  }
  
  .grid-details h3 {
    font-size: 15px;
    min-height: 36px;
  }
  
  .food-item {
    width: 160px;
  }
  
  .food-image-container {
    height: 120px;
  }
  
  .category-icon {
    height: 46px;
    width: 46px;
  }
  .aliexpress-header {
    padding: var(--space-sm) var(--space-md);
  }
  
  .restaurant-logo {
    width: 44px;
    height: 44px;
  }
  
  .logo {
    font-size: 22px;
  }
  
  .search-container {
    padding: 10px 16px;
  }
  
  .section-header h2 {
    font-size: 16px;
  }
}


/* Add floating cart button */
/* Persistent floating cart button styling */
.floating-cart-button {
  position: fixed;
  bottom: 80px; /* Default position if not yet dragged */
  right: 16px; /* Default position if not yet dragged */
  height: 40px; /* Smaller button height */
  padding: 0 14px; /* Reduced padding */
  border-radius: 20px; /* Adjusted for smaller size */
  background-color: {{ primary_brand_color }}; /* Use backend color */
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  border: none;
  cursor: grab;
  z-index: 9999;
  transition: all 0.3s ease;
  gap: 6px;
  user-select: none;
  touch-action: none;
  pointer-events: auto;
}

/* Tooltip to inform users they can drag */
.floating-cart-button::after {
  content: "Drag me";
  position: absolute;
  top: -30px; /* Position above the button */
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
  opacity: 0; /* Initially hidden */
  transition: opacity 0.3s ease;
  pointer-events: none;
  white-space: nowrap;
}

/* Show tooltip when .show-tooltip is added */
.floating-cart-button.show-tooltip::after {
  opacity: 1;
}

/* Optional: also show tooltip on hover if desired */
.floating-cart-button:hover::after {
  opacity: 1;
}

.floating-cart-button i {
  font-size: 10px;
}

.cart-count {
  font-size: 12px;
  font-weight: 500;
}

/* Explicitly set cursor when dragging */
.floating-cart-button.dragging {
  cursor: grabbing;
  z-index: 10000;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

/* Bounce animation when adding items */
@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.cart-bounce {
  animation: bounce 0.3s ease;
}



/* Animation when the icon stops */
@keyframes cartStop {
  0% { transform: rotate(0deg); }
  20% { transform: rotate(15deg); }
  40% { transform: rotate(-8deg); }
  60% { transform: rotate(4deg); }
  80% { transform: rotate(-2deg); }
  100% { transform: rotate(0deg); }
}

.cart-stop {
  animation: cartStop 0.6s ease;
}



/* Add some additional animations */
@keyframes slideInUp {
  from {
    transform: translateY(40px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.food-item, .grid-item {
  animation: slideInUp 0.5s ease-out;
  animation-fill-mode: both;
}

/* Stagger animation for items */
.food-item:nth-child(1), .grid-item:nth-child(1) { animation-delay: 0.1s; }
.food-item:nth-child(2), .grid-item:nth-child(2) { animation-delay: 0.15s; }
.food-item:nth-child(3), .grid-item:nth-child(3) { animation-delay: 0.2s; }
.food-item:nth-child(4), .grid-item:nth-child(4) { animation-delay: 0.25s; }
.food-item:nth-child(5), .grid-item:nth-child(5) { animation-delay: 0.3s; }
.food-item:nth-child(6), .grid-item:nth-child(6) { animation-delay: 0.35s; }
.food-item:nth-child(7), .grid-item:nth-child(7) { animation-delay: 0.4s; }
.food-item:nth-child(8), .grid-item:nth-child(8) { animation-delay: 0.45s; }

/* Loading shimmer effect for images */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.food-image.loading, .grid-image.loading {
  background: linear-gradient(90deg, var(--light-bg) 25%, var(--border-color) 50%, var(--light-bg) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* Add some depth to the overall design */
.main-content {
  position: relative;
  z-index: 1;
}

.shared-view {
  position: relative;
}

.shared-view::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100px;
  background: linear-gradient(to bottom, var(--background), transparent);
  pointer-events: none;
  z-index: -1;
}

.shared-view::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 100px;
  background: linear-gradient(to top, var(--background), transparent);
  pointer-events: none;
  z-index: -1;
}

/* Add a subtle shadow to create depth between sections */
.category-nav {
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.03);
}



/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    background-color: #f0f2f5;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    color: #1a1a1a;
}



/* Loading Skeleton */
.skeleton {
    background: linear-gradient(90deg, rgba(0,0,0,0.06) 25%, rgba(0,0,0,0.08) 37%, rgba(0,0,0,0.06) 63%);
    background-size: 400% 100%;
    animation: skeleton-loading 1.4s ease infinite;
}

@keyframes skeleton-loading {
    0% { background-position: 100% 50%; }
    100% { background-position: 0 50%; }
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--background);
    z-index: 1000;
}



.fixed-bottom-icons.hidden {
    transform: translateY(100%);
}

.nav-container {
    height: 100%;
    padding: 0 20px;
    max-width: 600px;
    margin: 0 auto;
}

.nav-item-wrapper {
    position: relative;
    padding: 0 4px;
}

.text-inherit {
    color: #333;
    text-decoration: none;
    transition: var(--transition);
    padding: 8px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.icon-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;  /* Reduced from 40px */
    height: 32px; /* Reduced from 40px */
}

/* Keep icons gray by default, but the cart icon (3rd item) is black with a white icon */
.fas {
    font-size: 16px !important; /* Reduced from 22px */
    color: #666;
    transition: var(--transition);
}

#cartIconCount {
    position: absolute;
    top: -2px;
    right: -2px;
    background: red;
    color: #fff;
    border-radius: 50%;
    min-width: 16px;    /* Reduced from 18px */
    height: 16px;       /* Reduced from 18px */
    font-size: 10px;    /* Reduced from 11px */
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
}

.text-inherit.active {
    color: #000;
}

.text-inherit.active .fas {
    color: #000;
}

/* Specifically style the 3rd nav item (cart) as in the screenshot */
.nav-item-wrapper:nth-child(3) .icon-wrapper {
    background: #000;
    border-radius: 50%;
    width: 38px;  /* Reduced from 45px */
    height: 38px; /* Reduced from 45px */
}

.nav-item-wrapper:nth-child(3) .fas {
    color: #fff; /* white icon */
}

.nav-label {
    font-size: 10px; /* Reduced from 12px */
    color: #666;
    margin: 0;
    line-height: 1;
    text-align: center;
    display: block;
}


@media (hover: hover) {
    .text-inherit:hover {
        background-color: rgba(7, 94, 84, 0.05);
        border-radius: 8px;
    }
}

/* Table Bar */
.table-bar {
    background: #1a1a1a;
    color: #fff;
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.table-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

.help-button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #fff;
    padding: 8px 16px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition);
}

.help-button:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Enhanced Header */
.brand-section {
    display: flex;
    flex-direction: column;
}

.brand-section h1 {
    font-size: 24px;
    margin-bottom: 2px;
}

.restaurant-name {
    font-size: 14px;
    color: var(--text-primary);
}

/* Cart Button */
.cart-button {
    background: var(--brand);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    cursor: pointer;
    color: #fff;
}

.cart-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #1a1a1a;
    color: #fff;
    font-size: 12px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

/* Enhanced Category Icons */
.category-icon-wrap {
    background: #f0f2f0;
    width: 52px;
    height: 52px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    transition: var(--transition);
}

.category-btn {
    padding: 14px;
}

.category-btn.active .category-icon-wrap {
    background: {{ secondary_brand_color }};
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(247, 192, 40, 0.2);
}

/* Cart Styles */
.offcanvas {
    border-radius: var(--border-radius) 0 0 var(--border-radius);
    max-width: 90%;
}

.cart-items {
    flex: 1;
    overflow-y: auto;
}

.cart-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.cart-item-image {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    object-fit: cover;
    margin-right: 1rem;
}

.cart-item-details {
    flex: 1;
}

.cart-item-name {
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.cart-item-price {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.quantity-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.quantity-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 1px solid var(--brand);
    background: none;
    color: var(--brand);
    display: flex;
    align-items: center;
    justify-content: center;
}

.cart-footer {
    padding: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.checkout-button {
    width: 100%;
    padding: 1rem;
    background: {{ primary_brand_color }};
    color: #fff;
    border: none;
    border-radius: var(--border-radius);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 500;
}

:root {
    --brand: #f7c028; /* New brand color */
    --background: #ffffff; /* New background color */
    --primary-color: var(--brand); /* Changed to use --brand */
    --primary-dark: #e6b024;
    --primary-light: #ffd24d;
    --background-color: var(--background); /* Changed to use --background */
    --surface-color: var(--background); /* Changed to use --background */
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --border-color: #e2e8f0;
    --success-color: #22c55e;
    --error-color: #ef4444;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --radius-sm: 0.5rem;
    --radius-md: 0.75rem;
    --radius-lg: 1rem;
    --radius-xl: 1.5rem;
    --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
}



html {
    -webkit-text-size-adjust: 100%;
}

.chat-container {
    max-width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: var(--surface-color);
    position: relative;
}

.modal-header {
    padding: 1rem;
    background: var(--surface-color);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow-sm);
    position: relative;
    z-index: 10;
}

.header-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.restaurant-icon {
    width: 2.75rem;
    height: 2.75rem;
    border-radius: var(--radius-lg);
    background: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
    box-shadow: var(--shadow-sm);
}

.table-info h5 {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0;
    color: var(--text-primary);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-xl);
    font-size: 0.875rem;
    font-weight: 500;
    gap: 0.375rem;
}

.status-badge.preparing {
    background: var(--primary-light);
    color: var(--text-primary);
}

.status-badge.completed {
    background: var(--success-color);
    color: #fff;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    background: var(--background-color);
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    scroll-behavior: smooth;
}

.message {
    max-width: 70%;
    min-width: 100px;
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-xl);
    position: relative;
    animation: slideIn 0.3s ease;
    word-break: break-word;
    font-size: 1rem;
    line-height: 1.2;
}

.restaurant-message {
    align-self: flex-start;
}
.restaurant-message .message-content {
    background: var(--surface-color);
    color: var(--text-primary);
    border-bottom-left-radius: var(--radius-sm);
    box-shadow: var(--shadow-md);
    text-align: left;
}

.customer-message {
    align-self: flex-end;
}
.customer-message .message-content {
    background: var(--primary-color);
    color: white;
    border-bottom-right-radius: var(--radius-sm);
    text-align: left;
}

.message-content {
    display: block;
}

.message-content p {
    margin: 0;
}

.system-message {
    align-self: center;
    background: #e0e7ff;
    color: #3730a3;
    border: 1px solid #c7d2fe;
    padding: 0.75rem 1rem;
    border-radius: 1.25rem;
    font-size: 0.875rem;
    text-align: center;
}

.order-summary {
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 0.75rem;
    margin-bottom: 0.75rem;
    max-width: 90%;
}

.order-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 1rem;
    color: var(--text-secondary);
}

.order-header i {
    color: var(--primary-color);
    font-size: 1.25rem;
}

.order-items {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.order-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: var(--text-primary);
    padding: 0.25rem 0;
}

.order-item.order-total {
    font-weight: 600;
    border-top: 1px solid var(--border-color);
    padding-top: 0.5rem;
}

.chat-input-area {
    padding: 1rem;
    padding-bottom: calc(1rem + var(--safe-bottom));
    background: var(--surface-color);
    
    position: relative;
    z-index: 10;
}

.input-group {
    display: flex;
    gap: 0.75rem;
    align-items: flex-end;
    max-width: 48rem;
    margin: 0 auto;
    position: relative;
}

.message-input {
    flex: 1;
    padding: 0.875rem 1rem;
    
    border-radius: var(--radius-xl);
    font-size: 1rem;
    background: var(--background-color);
    transition: var(--transition);
    resize: none;
    max-height: 120px;
    min-height: 48px;
}

.message-input:focus {
    outline: none;
    
    background: var(--surface-color);
}

.send-button {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    border: none;
    background: var(--primary-color);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    margin-left: 0.5rem;
}

.send-button:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}        


@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (min-width: 768px) {
    .chat-container {
        max-width: 48rem;
        margin: 1rem auto;
        height: calc(100vh - 2rem);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
    }
    .modal-header {
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    }
}

@media (max-width: 768px) {
    .chat-messages {
        padding: 1rem;
    }
    .message {
        max-width: 85%;
    }
    .modal-header,
    .chat-input-area {
        padding: 1rem;
    }
    .message-input {
        font-size: 1rem;
    }
}

/* Profile Section */
.profile-wrapper {
    padding: 16px;
}

.profile-card {
    background: var(--background);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-sm);
}

.profile-header-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.profile-avatar {
    position: relative;
    margin-bottom: 16px;
}

.avatar-img {
    width: 88px;
    height: 88px;
    border-radius: 50%;
    border: 2px solid var(--brand);
    background: var(--surface);
    object-fit: cover;
}

.avatar-edit {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 28px;
    height: 28px;
    background: var(--brand);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 12px;
    border: 2px solid var(--background);
    cursor: pointer;
}

.profile-name {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.profile-tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
}

.profile-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 6px 12px;
    background: var(--brand-light);
    color: var(--brand);
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 500;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    padding: 16px;
}

.stat-item {
    background: var(--background);
    border-radius: var(--radius-md);
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: var(--shadow-sm);
}

.stat-item i {
    width: 40px;
    height: 40px;
    background: var(--brand-light);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--brand);
    font-size: 16px;
}

.stat-info {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
}

.stat-label {
    font-size: 13px;
    color: var(--text-secondary);
}

/* Profile Menu */
.profile-menu {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.menu-link {
    background: var(--background);
    border-radius: var(--radius-md);
    padding: 16px;
    display: flex;
    align-items: center;
    text-decoration: none;
    color: var(--text-primary);
    box-shadow: var(--shadow-sm);
    transition: transform 0.2s ease;
    cursor: pointer;
}

.menu-link:hover {
    transform: translateX(4px);
}

.menu-link i:first-child {
    width: 24px;
    margin-right: 12px;
    color: var(--brand);
}

.menu-link span {
    flex: 1;
    font-weight: 500;
}

.menu-link i.fa-chevron-right {
    color: var(--text-secondary);
    font-size: 14px;
}

.menu-link-logout {
    margin-top: 8px;
}

.menu-link-logout i:first-child {
    color: var(--brand);
}

/* Responsive Adjustments for Profile Section */
@media (min-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 600px;
        margin: 0 auto;
    }
    .profile-menu {
        max-width: 600px;
        margin: 0 auto;
    }
}

@media (max-width: 380px) {
    .profile-wrapper {
        padding: 12px;
    }
    .profile-menu {
        padding: 12px;
        width: 100%;
        margin: 0;
    }
    .menu-link {
        padding: 14px;
        width: 100%;
    }
    .stats-grid {
        gap: 12px;
        padding: 12px;
    }
    .stat-item {
        padding: 12px;
    }
    .stat-value {
        font-size: 16px;
    }
}

.nav-item-wrapper a.active {
    color: var(--brand);
}

.nav-item-wrapper a.active .nav-label {
    color: var(--brand);
}

/* Keep the icon color white on the add-to-cart button */
.add-to-cart-btn i {
  color: #fff;
  margin-right: 5px;
}
/* 1) Make all nav items turn brand color on active */
.text-inherit.active {
  color: var(--brand) !important;
}
.text-inherit.active .fas {
  color: var(--brand) !important;
}

/* 2) Exclude the 3rd nav item (cart) from changing color */
.nav-item-wrapper:nth-child(3) .text-inherit.active {
  color: #fff !important;
}
.nav-item-wrapper:nth-child(3) .text-inherit.active .fas {
  color: #fff !important;
}

/* OFFCANVAS WRAPPER */
.offcanvas {
  width: 100%;
  max-width: 380px;
  background: var(--background);
  box-shadow: var(--shadow);
  position: fixed;
  top: 0;
  right: 0;
  height: 100%;
  transform: translateX(100%);
  transition: transform 0.3s ease;
  z-index: 1050;
  display: flex;
  flex-direction: column;
}

.offcanvas.show {
  transform: translateX(0);
}

.offcanvas-header {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  border-bottom: 1px solid #eee;
}

.offcanvas-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.offcanvas-title span {
  background: black;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.875rem;
  margin-left: 0.5rem;
}

.btn-close {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
}

.offcanvas-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

/* CART TOP SECTION (Co-delivery, Time, Address, Chat) */
.cart-info {
  background: white; /* or var(--background) if you prefer */
  padding: 0 1rem 1rem;
  margin-bottom: 1rem;
}

.cart-info-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.cart-info-switch {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* Toggle Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 20px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
  border-radius: 20px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 14px;
  width: 14px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--brand, #f59e0b); /* Adjust brand color */
}
input:checked + .slider:before {
  transform: translateX(14px);
}

/* Time & Address Rows */
.cart-info-time,
.cart-info-address {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.875rem;
  color: var(--text-secondary, #555);
}

/* Chat Button */
.cart-info-chat {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary, #555);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* "Order" Heading Above Cart Items */
.cart-order-heading {
  font-size: 1rem;
  font-weight: 600;
  margin: 0 1rem 0.75rem;
  color: var(--text-primary, #222);
}

/* CART ITEMS */
.cart-items {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  padding-bottom: 1rem;
}

.cart-item {
  display: flex;
  align-items: center;
  padding: 0.75rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin-bottom: 0.75rem;
}

.cart-item-image {
  width: 60px;
  height: 60px;
  border-radius: 6px;
  object-fit: contain;  /* Changed from cover to contain */
  margin-right: 0.75rem;
}

.cart-item-details {
  flex: 1;
}

.cart-item-name {
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 0.25rem;
}

.cart-item-price {
  font-size: 1rem;
  font-weight: 600;
  color: black;
  margin-bottom: 0.5rem;
}

.quantity-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  background: white;
  padding: 0.25rem;
  border-radius: 6px;
  width: fit-content;
}

.quantity-btn {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  border: none;
  background: {{ primary_brand_color  }};
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.quantity-controls span {
  font-weight: 500;
  min-width: 20px;
  text-align: center;
}

.remove-item {
  background: none;
  border: none;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  color: #dc2626;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* CART SUMMARY */
.cart-summary {
  flex-shrink: 0;
  background: #f8f9fa;
  padding: 1rem;
  border-top: 1px solid #eee;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.summary-row:last-child {
  margin-bottom: 0;
  padding-top: 0.5rem;
  border-top: 1px dashed #eee;
}

/* Example "Delivery" row */
.summary-row.delivery-fee {
  margin-top: 0.5rem;
}

#cartTotal {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

/* CART FOOTER */
.cart-footer {
  flex-shrink: 0;
  padding: 1rem;
  background: white;
  border-top: 1px solid #eee;
}

/* "Pay" BUTTON */
.checkout-button {
  width: 100%;
  padding: 0.75rem;
  background: {{ primary_brand_color }};
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.checkout-button:hover {
  background: #f7c028; /* Slightly darker on hover */
}

.checkout-button:active {
  opacity: 0.9;
}

/* OFFCANVAS BACKDROP */
.offcanvas-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.3);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1040;
}

.offcanvas-backdrop.show {
  opacity: 1;
}

/* MOBILE OPTIMIZATIONS */
@media (max-width: 768px) {
  .offcanvas {
    max-width: 100%;
    height: 100%;
  }
  .cart-items {
    -webkit-overflow-scrolling: touch;
  }
  .cart-summary,
  .cart-footer {
    position: sticky;
    bottom: 0;
    background: white;
    z-index: 1;
  }
  .cart-footer {
    padding-bottom: max(1rem, env(safe-area-inset-bottom, 1rem));
  }
  .checkout-button {
    padding: 1rem;
  }
}

/* SCROLLBAR STYLING */
.cart-items::-webkit-scrollbar {
  width: 4px;
}

.cart-items::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.cart-items::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 2px;
}
</style>



<style>
    /* Helper class to hide inactive sections */
    .hidden {
      display: none !important;
    }
    /* (Your existing styling can remain here) */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    /* Optional: Ensure each section has enough bottom padding so the fixed nav does not cover content */

    .nav-item-wrapper a {
      text-decoration: none;
      color: inherit;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Active state styling */
    .active {
      color: red; /* Adjust to your design */
    }
  </style>



<style>
.btn-check:checked + .btn {
    background-color: #f7c028; !important;
    color: white !important;
}

.btn:hover {
    background-color: #f7c028; !important;
    color: white !important;
}
</style>

<style>
  /* Splash screen covers the whole viewport */
  .splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #fff; /* Black background */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.5s ease-out;
  }
  .splash-screen.fade-out {
    opacity: 0;
  }

  /* Center and animate the logo content */
  .splash-content {
    text-align: center;
    transform: translateY(-10%);
    color: #fff;
  }

  /* Wrapper for your logo image */
  .logo-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    animation: logoAnimation 1.5s ease-in-out;
  }

  /* Actual logo image; adjust size as needed */
  .logo-image {
    width: 180px; 
    height: auto;
    opacity: 0;                 /* Start invisible */
    animation: fadeIn 0.8s ease-out 0.5s forwards; 
    /* The 0.5s delay gives the scale animation time to play first, 
       if you want to match the original “pop” effect. */
  }

  .tagline {
    font-size: 16px;
    color: #ccc; /* Slightly gray */
    margin-top: 0.7px;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUpIn 0.5s ease-out 1s forwards;
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  .loading-dots {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 25px;
  }
  .dot {
    width: 6px;
    height: 6px;
    background-color: #FFE135; /* Yellow color */
    border-radius: 50%;
    animation: dotPulse 1s infinite;
  }
  .dot:nth-child(2) {
    animation-delay: 0.2s;
  }
  .dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  /* Animations */
  @keyframes logoAnimation {
    0%   { transform: scale(0.8); }
    50%  { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  @keyframes fadeUpIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes dotPulse {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.5);
      opacity: 0.5;
    }
  }
</style>
 
<style>
.notification-banner {
  display: flex;
  justify-content: center;
  align-items: center;
   background-color: #f0f8f0;  /* Light green background */
  color: #333;  /* Dark text for better readability */
  padding: 10px 20px;
  width: 100%;
  position: relative;
}

.notification-icon {
  background-color: #4CD964;  /* Green circle */
  border-radius: 50%;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 10px;
  flex-shrink: 0;
}

.notification-message {
  flex: 1;
  text-align: center;
  font-weight: 500;
}

.notification-button {
  display: inline-block;
  background-color: #222;
  color: white;
  padding: 6px 16px;
  border-radius: 4px;
  margin-left: 16px;
  text-decoration: none;
  font-weight: bold;
}

.notification-close {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 18px;
  padding: 0 10px;
}
</style>

<style>
  :root {
  --bg-color: #ffffff;
  --accent: #ff6b6b;
  --accent-light: #ff8c8c;
  --text: #2c3e50;
  --subtext: #7d879c;
  --shadow: rgba(0, 0, 0, 0.1);
  --transition: 0.3s;
}

body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  background: #f2f4f7;
}

.product-modal {
  background: var(--bg-color);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 15px 30px var(--shadow);
  position: relative;
}

/* Smaller Close Button */
.modal-close {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #ffffff;
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  font-size: 1.2rem;
  color: red;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform var(--transition), box-shadow var(--transition);
}
.modal-close:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
}

/* Modal Entrance Animation */
@keyframes modalAppear {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.modal.show .modal-dialog {
  animation: modalAppear 0.3s ease-out;
}

.modal-grid {
  display: grid;
  grid-template-columns: 1fr;
}

.image-section {
  position: relative;
  background: #f8f9fa;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 15px;
}
.image-section img {
  max-width: 100%;
  max-height: 280px;
  transition: transform var(--transition);
  object-fit: cover;
  border-radius: 12px;
}
/* Adjusted hover effect for minimal zoom */
.image-section img:hover {
  transform: scale(1.02);
}


.nav-btn {
    position: absolute;
    top: 50%;
    background: rgba(255,255,255,0.9);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    transition: background var(--transition), color var(--transition); /* Added color transition */
    transform: translateY(-50%);
    z-index: 5; /* Ensure they are above the image */
    display: flex; /* Better centering */
    align-items: center;
    justify-content: center;
}
.nav-btn:hover {
    background: var(--accent);
    color: #fff;
}
.prev { left: 10px; }
.next { right: 10px; }

.info-section {
    padding: 12px; /* Reduced padding */
    text-align: center;
    max-height: calc(90vh - 260px); /* Adjusting remaining space */
    overflow-y: auto; /* Enable scroll if content overflows */
}
.info-section h2 {
    margin: 0 0 4px 0; /* Add small margin below */
    font-size: 1.4rem;
    color: var(--text);
    font-weight: 600; /* Make title slightly bolder */
    line-height: 1.3;
}
.rating {
    margin: 4px 0; /* Reduced margin */
    display: inline-flex;
    align-items: center;
    color: var(--accent); /* Original accent color for rating */
    font-weight: bold;
    font-size: 0.9rem; /* Match original size */
}
.rating i {
    margin-right: 5px;
    font-size: 0.85rem; /* Star size */
}
.pricing {
    margin: 6px 0; /* Reduced margin */
    display: flex;
    justify-content: center;
    align-items: baseline; /* Align prices */
    gap: 8px; /* Reduced gap */
}
.current-price {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--accent);
}
.old-price {
    font-size: 0.95rem;
    color: var(--subtext);
    text-decoration: line-through;
}

/* Special Offer Note */
.special-offer-note {
    margin-top: 6px; /* Reduced margin */
    padding: 3px 6px; /* Reduced padding */
    background-color: #ffeb3b; /* Original bright yellow background */
    color: #333; /* Original dark text for contrast */
    border-radius: 4px;
    font-size: 13px; /* Smaller font */
    font-weight: 500;
    display: none; /* Hidden by default - controlled by JS */
    max-width: 95%; /* Prevent full width */
    margin-left: auto;
    margin-right: auto; /* Center */
}

.gst-note {
    font-size: 0.8rem;
    color: var(--subtext);
    margin-bottom: 8px; /* Reduced margin */
    margin-top: 4px; /* Add small top margin */
    display: none; /* Hidden by default - controlled by JS */
}

/* Simplified Product Description Styling */
.product-description {
    margin: 10px 0; /* Reduced margin */
    text-align: left; /* Left align description text */
    color: var(--text);
    font-size: 0.9rem; /* Slightly smaller font */
    line-height: 1.4; /* Reduced line height */
    max-height: 60px; /* Limited height */
    overflow-y: auto; /* Scroll for overflow */
    padding-right: 5px; /* Space for scrollbar */
    border-top: 1px solid #eee; /* Light separator */
    padding-top: 8px; /* Space above text */
}
.product-description::-webkit-scrollbar {
    width: 3px; /* Thinner scrollbar */
}
.product-description::-webkit-scrollbar-thumb {
    background-color: var(--accent-light);
    border-radius: 10px;
}
.product-description::-webkit-scrollbar-track {
    background: #f1f1f1; /* Light track */
    border-radius: 10px;
}

.controls {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Reduced gap */
    align-items: center;
    margin-top: 10px; /* Margin above controls */
    padding-top: 10px; /* Padding above controls */
    border-top: 1px solid #eee; /* Light separator */
}
.size-selection {
    display: flex; /* JS controls actual display via d-none/style */
    gap: 8px; /* Reduced gap */
    flex-wrap: wrap; /* Allow wrapping */
    justify-content: center; /* Center buttons */
}
.size-btn {
    width: 36px; /* Slightly smaller buttons */
    height: 36px;
    border-radius: 50%;
    border: 1px solid #e0e0e0; /* Subtle border */
    background: #e9ecef;
    color: var(--text);
    font-weight: 600;
    font-size: 0.85rem; /* Slightly smaller font */
    cursor: pointer;
    transition: background var(--transition), transform var(--transition), border-color var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}
.size-btn:hover:not(.active) {
    background: #dfe4ea;
    border-color: #c0c6cc;
}
.size-btn.active {
    background: var(--accent);
    color: #fff;
    transform: scale(1.1); /* Keep active scale */
    border-color: var(--accent);
}
.size-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.quantity-control {
    display: flex; /* JS controls actual display via d-none */
    align-items: center;
    gap: 10px; /* Reduced gap */
    background: #f1f3f5;
    border-radius: 30px;
    padding: 4px 12px; /* Reduced padding */
}
.quantity-btn {
    background: #fff;
    border: none;
    border-radius: 50%;
    width: 30px; /* Smaller buttons */
    height: 30px;
    font-size: 1.2rem;
    color: var(--text);
    cursor: pointer;
    transition: background var(--transition), color var(--transition); /* Added color transition */
    box-shadow: 0 2px 4px var(--shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1; /* Center symbols */
}
.quantity-btn:hover {
    background: var(--accent);
    color: #fff;
}
#quantityDisplay {
    font-size: 1rem;
    font-weight: 500;
    min-width: 20px; /* Ensure space */
    text-align: center;
}

/* Responsive adjustments */
@media(min-width: 768px) {
    .modal-dialog {
        max-width: 650px; /* Slightly smaller max-width than reimagined */
    }
    .modal-grid {
        grid-template-columns: 1fr 1fr; /* Switch to two columns */
    }
    .image-section {
        height: 300px; /* Adjusted height for larger screens */
    }
    .image-section img {
        max-height: 280px; /* Adjusted for larger screens */
    }
    .info-section {
        max-height: 300px; /* Match image section height */
        padding: 15px; /* Slightly more padding on desktop */
        text-align: left; /* Left align text */
    }
    .info-section h2 {
        text-align: left;
    }
     .rating {
         justify-content: flex-start; /* Align left */
    }
    .pricing {
        justify-content: flex-start; /* Align left */
    }
     .special-offer-note {
         margin-left: 0; /* Align left */
         margin-right: 0;
         max-width: 100%;
    }
     .gst-note {
         text-align: left;
     }
    .controls {
        align-items: flex-start; /* Align controls left */
        padding-top: 15px;
    }
     .size-selection {
        justify-content: flex-start; /* Align sizes left */
    }
}

/* Animation for modal */
@keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}
/* Use the existing animation keyframes if preferred */
/* .modal.show .modal-content { */
/* animation: modalFadeIn 0.2s ease forwards; */
/* } */

/* Fix for touch interactions */
button {
    touch-action: manipulation;
}
</style>


<!-- Add this to your CSS style section -->
<style>
@keyframes glowing {
    0% {
        box-shadow: 0 0 5px #ff6b6b;
    }
    100% {
        box-shadow: 0 0 15px #ff6b6b, 0 0 20px #ff8c8c;
    }
}


/* Enhanced Popup Styles */
.description-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px;
    border-radius: 16px;
    max-width: 80%;
    max-height: 80%;
    overflow-y: auto;
    z-index: 1060;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    display: none;
    animation: popupFadeIn 0.3s ease-out;
    border: 1px solid #f0f0f0;
}

/* Custom scrollbar for the popup */
.description-popup::-webkit-scrollbar {
    width: 6px;
}

.description-popup::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.description-popup::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 10px;
    transition: background 0.3s;
}

.description-popup::-webkit-scrollbar-thumb:hover {
    background: #ff6b6b;
}

.popup-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1050;
    display: none;
    animation: backdropFadeIn 0.2s ease-out;
    backdrop-filter: blur(3px);
}

.popup-close {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    cursor: pointer;
    color: #ff6b6b;
    border: none;
    transition: all 0.2s;
    line-height: 0;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.popup-close:hover {
    background: #ff6b6b;
    color: white;
    transform: rotate(90deg);
}

/* Popup animations */
@keyframes popupFadeIn {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

@keyframes backdropFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Improved styling for popup content */
.description-popup h3 {
    margin-bottom: 20px;
    color: #2c3e50;
    font-weight: 600;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

#popupDescription {
    line-height: 1.6;
    color: #4a5568;
}

/* Media query for mobile improvements */
@media (max-width: 768px) {
    .description-popup {
        max-width: 95%;
        padding: 20px 15px;
    }
}
</style>

<style>
/* Enhanced styling to make the details button more noticeable */
.pricing-container {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 10px 0;
  position: relative;
}

.pricing {
  display: flex;
  align-items: baseline;
  gap: 8px;
}

.details-tag {
  position: relative;
  margin-left: 15px;
  transform: translateY(-2px);
  /* Added subtle bounce animation to draw attention */
  animation: subtle-bounce 3s ease-in-out infinite;
}

/* Subtle bounce animation */
@keyframes subtle-bounce {
  0%, 100% { transform: translateY(-2px); }
  50% { transform: translateY(0px); }
}

.details-button {
  background: linear-gradient(135deg, #2c3e50, #34495e);
  color: white;
  border: none;
  padding: 6px 12px 6px 30px;
  border-radius: 0 20px 20px 0;
  font-size: 0.85rem;
  cursor: pointer;
  position: relative;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  overflow: hidden;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
  /* Added subtle pulse for the shadow */
  animation: pulse-shadow 2s infinite alternate;
}

/* Pulse shadow animation */
@keyframes pulse-shadow {
  from { box-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
  to { box-shadow: 2px 2px 8px rgba(0,0,0,0.4), 0 0 3px rgba(255,107,107,0.3); }
}

.details-button:hover {
  transform: translateX(3px);
  background: linear-gradient(135deg, #34495e, #4a6b8a);
}

.details-icon {
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: white;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Added subtle glow */
  box-shadow: 0 0 5px rgba(255,255,255,0.8);
}

.details-icon i {
  color: #2c3e50;
  font-size: 12px;
}

.details-ribbon {
  position: absolute;
  left: -10px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  background: #ff6b6b;
  clip-path: polygon(0 50%, 100% 0, 100% 100%);
  /* Added shimmering effect */
  animation: shimmer 2s infinite;
}

/* Shimmer animation for the ribbon */
@keyframes shimmer {
  0% { background: #ff6b6b; }
  50% { background: #ff8c8c; }
  100% { background: #ff6b6b; }
}

.details-text {
  font-weight: 500;
  letter-spacing: 0.5px;
  padding-left: 2px;
  /* Added subtle text movement */
  position: relative;
  animation: text-glow 2s infinite alternate;
}

@keyframes text-glow {
  from { text-shadow: none; }
  to { text-shadow: 0 0 3px rgba(255,255,255,0.5); }
}

/* Responsive adjustments */
@media(min-width: 768px) {
  .pricing-container {
    justify-content: flex-start;
  }
}

/* Remove the original info button container styles */
.info-button-container {
  display: none;
}

/* Add this to your CSS */
.details-tag[data-has-description="false"] {
    display: none !important; /* Force hide with !important */
}

.details-tag {
    display: none; /* Default to hidden */
}

.details-tag[data-has-description="true"] {
    display: block; /* Only show when there's a description */
}
</style>

 




</head>
   <body>

    <!-- Navbar -->

    <!-- Offcanvas Cart Structure -->
    <!-- Offcanvas Cart Structure (IDs & structure remain unchanged) -->
  <!-- (A) OFFCANVAS CART STRUCTURE -->
<!-- (A) OFFCANVAS CART STRUCTURE -->
<div class="offcanvas offcanvas-end" id="offcanvasRight" tabindex="-1">
  <!-- Offcanvas Header -->
  <div class="offcanvas-header">
    <!-- Example: keep the "Cart #", or rename as desired -->
    <h5 class="offcanvas-title">
      Cart <span id="cartCount">0</span>
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close">
      <!-- Close icon -->
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Offcanvas Body -->
  <div class="offcanvas-body">
    
    <!-- TOP SECTION: co-delivery, time, address, chat icon -->
    <div class="cart-info">
      <!-- First row: co-delivery toggle & time -->
      <div class="cart-info-row">
        <div class="cart-info-switch">
          
          <span></span>
        </div>
        <div class="cart-info-time">
          <!-- Example time icon (optional) -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 6v6l4 2"></path>
          </svg>
          <span>15 min</span>
        </div>
      </div>

      <!-- Second row: address & chat icon -->
      <div class="cart-info-row">
        <div class="cart-info-address">
          <!-- Example location icon -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <span>{{ restaurant.restaurant_name }}</span>
        </div>
        <button class="cart-info-chat" aria-label="Chat">
          <!-- Example chat icon -->
          <!-- <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg> -->
        </button>
      </div>
    </div>

    <!-- "Order" heading, as shown in screenshot -->
    <h6 class="cart-order-heading">Order</h6>

    <!-- Cart Items (unchanged logic) -->
    <div id="cartItems" class="cart-items">
      <!-- Cart items will be inserted here by your JS -->
      <template id="cartItemTemplate">
        <div class="cart-item">
          <img src="${productImage}" alt="${productName}" class="cart-item-image">
          <div class="cart-item-details">
            <div class="cart-item-name">${productName}</div>
            <div class="cart-item-price">$${productPrice.toFixed(2)}</div>
            <div class="quantity-controls">
              <button class="quantity-btn decrement" data-product-id="${itemId}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <span>${quantity}</span>
              <button class="quantity-btn increment" data-product-id="${itemId}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
            </div>
          </div>
          <button class="remove-item" data-product-id="${itemId}" aria-label="Remove item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </template>
    </div>

    <!-- Cart Summary (with "Delivery" line) -->
    <div class="cart-summary">
      <div class="summary-row">
        <span>Order</span>
        <span id="cartTotal">$0.00</span>
      </div>
      <!-- Example line: "Delivery: Free from $5" -->
      <div class="summary-row delivery-fee">
        
        <span></span>
      </div>
    </div>

    <!-- Footer with "Pay" button -->
    <div class="cart-footer">
      <button
      id="checkoutButton"
      class="checkout-button"
      data-restaurant-id="{{ restaurant.id }}"
      data-checkout-url="{% url 'restaurant_checkout' restaurant_name_slug=restaurant.slug hashed_slug=restaurant.hashed_slug %}">

      <!-- Example pay icon -->
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7"></path>
        <path d="M21 5.618a1 1 0 00-1.447-.894L15 7v13l5.447-2.724A1 1 0 0021 16.382V5.618z"></path>
        <path d="M9 7v13"></path>
      </svg>
      Checkout
    </button>
    </div>
  </div>

  

  <!-- Loading Overlay (unchanged) -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-content">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M12 6v6l4 2"></path>
      </svg>
      <p>Processing...</p>
    </div>
  </div>
</div>



    

    <!-- Toast Notification -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="guestToast" class="toast align-items-center text-bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    You are currently viewing the site as a guest.
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

      
  <!-- ===============================
       Orders Modal (Fullscreen Chat Orders)
       (This modal remains separate and unaffected)
  ================================ -->
  <div class="modal fade" id="ordersFullscreen" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content chat-container">
        <!-- Header -->
        <div class="modal-header border-bottom sticky-top bg-white">
          <div class="header-info">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
            <div class="restaurant-icon">
              <i class="fas fa-utensils"></i>
            </div>
            <div class="table-info">
              <h5>Table #1</h5>
              <div>
                <small class="text-muted">Order #12345</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages">
          <div class="message system-message">
            <i class="fas fa-info-circle me-2"></i>
            Order Received
            <span class="message-time">2 mins ago</span>
          </div>
          <div class="message restaurant-message">
            <div class="message-content">
              <div class="order-summary">
                <div class="order-header">
                  <i class="fas fa-receipt"></i>
                  <h6 style="margin: 0; font-weight: 600;">Order Summary</h6>
                </div>
                <div class="order-items">
                  <div class="order-item">
                    <span>2× Classic Burger</span>
                    <span>$19.98</span>
                  </div>
                  <div class="order-item">
                    <span>1× Large Fries</span>
                    <span>$3.50</span>
                  </div>
                  <div class="order-item order-total">
                    <span>Total</span>
                    <span>$23.48</span>
                  </div>
                </div>
              </div>
              <span class="message-time">1 min ago</span>
            </div>
          </div>
          <!-- <div class="message customer-message">
            <div class="message-content">
              <p style="margin: 0">Please add extra ketchup</p>
              <span class="message-time">Just now</span>
            </div>
          </div> -->
        </div>

        <!-- Input -->
        <div class="chat-input-area">
          
            <input type="text"  class="message-input" placeholder="Type a message..." id="messageInput" aria-label="Message input">
            <button class="send-button" type="button" id="sendButton">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
    </div>
  </div>

  <!-- ===============================
       MENU SECTION
       (Default visible on page load)
  ================================ -->



  <section id="menuSection" class="menu-app-container">
       
  <!-- App Header -->

{% if notification %}
<div class="notification-banner" id="notification-banner">
  <div class="notification-message">
    
    <div class="notification-description">{{ notification.message }}</div>
  </div>
  <button class="notification-close" onclick="closeNotification()">
    <i class="fas fa-times"></i>
  </button>
</div>
{% endif %}


<!-- Header -->
<div class="aliexpress-header">
  <!-- Left side: hamburger menu + brand info -->
  <div class="header-left">
    <button class="filter-button">
      <i class="fas fa-sliders-h"></i>
    </button>
    <div class="brand-info">
      <div class="logo">Delvrr</div>
      <div class="restaurant-name-container">
        <i class="fas fa-map-marker-alt location-icon"></i>
        <p class="restaurant-name">{{ restaurant.restaurant_name }}</p>
      </div>
    </div>
  </div>
  <!-- Right side: restaurant logo and actions -->
  <div class="header-icons">
    
    <img
      src="{{ restaurant.logo_pic.url }}"
      alt="Restaurant Logo"
      class="restaurant-logo"
    />
  </div>
</div>

<!-- Search Section -->
<div class="search-header">
  <div class="search-container">
    <i class="fas fa-search search-icon"></i>
    <input
      type="text"
      class="search-input"
      placeholder="Search for menu items"
    />
    <div class="search-results-dropdown" style="display: none;">
      <div class="search-results-content"></div>
    </div>
  </div>
</div>

<!-- Category Navigation (Sticky) -->
<div class="category-nav">
  <div class="category-scroll">
    <!-- Default category button for "All" food -->
    {% if not hide_all_category %}
    <button class="category-btn active" data-category="featured">
      <div class="category-icon">
        🍱
      </div>
      <span>All</span>
    </button>
    {% endif %}
    {% for category in categories %}
      <button class="category-btn {% if hide_all_category and forloop.first %}active{% endif %} {% if category.is_new %}new{% endif %}" data-category="{{ category.name }}">
        <div class="category-icon">
          {{ category.emoji|default:"" }}
        </div>
        <span>{{ category.name }}</span>
      </button>
    {% endfor %}
  </div>
</div>

<!-- 
<div class="promo-banner">
  <div class="promo-content">
    <h2>Get 32% Promo</h2>
    <button class="buy-button">Order Now</button>
  </div>
  <div class="promo-image">
    You can replace this with your shrimp/food image
    <svg viewBox="0 0 100 100" width="60" height="60">
      <path d="M20,50 Q50,20 80,50" fill="none" stroke="#fff" stroke-width="4"/>
      <path d="M20,60 Q50,30 80,60" fill="none" stroke="#fff" stroke-width="4"/>
    </svg>
  </div>
</div> -->

<!-- Featured Items Section (Sample) -->
{% load thumbnail %}
{% load product_extras %}

<div class="main-content" id="menuContent">
  <div class="featured-section shared-view">
    <div class="section-header">
      <h2>Popular</h2>
      <button class="view-all">See all</button>
    </div>
    <div class="items-carousel">
      {% for category_products in allProds %}
        {% for product in category_products %}
          <div class="food-item"
               data-has-variations="{% if product.variations_list %}true{% else %}false{% endif %}"
               data-category="{{ product.category.name|lower }}"
               data-product-id="{{ product.id }}"
               data-name="{{ product.name }}"
               data-description="{{ product.description|default_if_none:'' }}"
               data-image="{{ product.product_image.url }}"
               data-gst="{{ product.gst_note }}"
               data-price-by-percentage="{% if product.price_by_percentage %}true{% else %}false{% endif %}"
               data-special-offer="{{ product.special_offer|default_if_none:'' }}"
               {% if product.variations_list %}
                 {% with default_price=product.variations_list|get_default_price:"S" %}
                   data-price="{% if default_price %}{{ default_price }}{% else %}{{ product.get_display_price }}{% endif %}"
                 {% endwith %}
                 {% for variation in product.variations_list %}
                   {% if variation.name == "S" %}
                     data-price-s="{{ variation.price }}"
                   {% elif variation.name == "M" %}
                     data-price-m="{{ variation.price }}"
                   {% elif variation.name == "L" %}
                     data-price-l="{{ variation.price }}"
                   {% elif variation.name == "F" %}
                     data-price-f="{{ variation.price }}"
                   {% endif %}
                 {% endfor %}
               {% else %}
                 data-price="{{ product.get_display_price }}"
                 data-price-s="{{ product.get_display_price }}"
                 data-price-m="{{ product.get_display_price }}"
                 data-price-l="{{ product.get_display_price }}"
                 data-price-f="{{ product.get_display_price }}"
               {% endif %}
          >
            <div class="food-image-container">
              {% if product.status == 'Sale' %}
                <span class="discount-badge">Sale</span>
              {% endif %}
              <div class="food-image">
                <div class="food-image-inner">
                  
                  {# Create all three thumbnail blocks first #}
                  {% thumbnail product.product_image "400x400" crop="center" as thumb400 %}
                    {% thumbnail product.product_image "800x800" crop="center" as thumb800 %}
                      {% thumbnail product.product_image "1200x1200" crop="center" as thumb1200 %}
                        
                        <img src="{{ thumb400.url }}"
                             srcset="{{ thumb400.url }} 400w,
                                     {{ thumb800.url }} 800w,
                                     {{ thumb1200.url }} 1200w"
                             sizes="(max-width: 600px) 400px,
                                    (max-width: 1200px) 800px,
                                    1200px"
                             alt="{{ product.name }}"
                             class="product-image-trigger"
                             loading="{% if forloop.counter <= 3 %}eager{% else %}lazy{% endif %}"
                             style="width:100%; height:100%; object-fit:cover;">
                      
                      {% endthumbnail %}
                    {% endthumbnail %}
                  {% endthumbnail %}

                </div>
              </div>
            </div>
            <div class="food-details">
              <h3>{{ product.name }}</h3>
              <div class="rating">
                <i class="fas fa-star"></i>
                <span>4.9</span>
                <span class="review-count">(203)</span>
              </div>
              <div class="price-row">
                <div class="price">
                  <span class="display-price">
                    {% if product.variations_list %}
                      {% with default_price=product.variations_list|get_default_price:"S" %}
                        {{ default_price|default:product.get_display_price }}
                      {% endwith %}
                    {% else %}
                      {{ product.get_display_price }}
                    {% endif %}
                  </span>
                  {% if product.previous_price %}
                    <span class="previous-price"
                          style="text-decoration:line-through; font-size:12px; color:var(--text-secondary); margin-left:4px;">
                      ${{ product.previous_price }}
                    </span>
                  {% endif %}
                </div>
                {% if product.status != 'Unavailable' %}
                  <button class="add-to-cart"
                          data-product-id="{{ product.id }}"
                          data-name="{{ product.name }}"
                          data-price="{% if product.variations_list %}
                                        {% with dp=product.variations_list|get_default_price:'S' %}
                                          {{ dp|default:product.get_display_price }}
                                        {% endwith %}
                                      {% else %}
                                        {{ product.get_display_price }}
                                      {% endif %}"
                          data-price-by-percentage="{% if product.price_by_percentage %}true{% else %}false{% endif %}"
                          data-image="{{ product.product_image.url }}">
                    <i class="fas fa-shopping-cart"></i>
                  </button>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% endfor %}
    </div>
  </div>
</div>



  
  <!-- Grid View for "View All" -->
  <div class="product-grid-container shared-view" id="productGridContainer">
    <div class="section-header">
      <h2>All Menu</h2>
      <button class="back-to-carousel"><i class="fas fa-chevron-left"></i> Back</button>
    </div>
    <div class="product-grid" id="productGrid">
      <!-- Grid items will be dynamically populated here -->

    </div>
  </div>
</div>

 <button class="floating-cart-button" 
      data-bs-toggle="offcanvas" 
      data-bs-target="#offcanvasRight" 
      aria-controls="offcanvasRight">
  <i class="fas fa-shopping-bag"></i>
  <span class="cart-count" id="cartIconCount">0 Items</span>
</button>





    
    

  </section>

  <!-- ===============================
       PROFILE SECTION
       (Starts hidden by default)
  ================================ -->
  <div id="userSection" class="menu-app-container hidden">
    <!-- Profile Header -->
    <div class="app-header">
      <div class="header-content">
        <h1>Profile</h1>
        <div class="header-actions">
          <button class="icon-button">
            <i class="fas fa-bell"></i>
          </button>
          <button class="icon-button search-button">
            <i class="fas fa-gear"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Profile Card -->
    <div class="profile-wrapper">
      <div class="profile-card">
        <div class="profile-header-content">
          <div class="profile-avatar">
            <img src="" alt="Profile Image" class="avatar-img">
            <span class="avatar-edit">
              <i class="fas fa-camera"></i>
            </span>
          </div>
          <h2 class="profile-name">{{ request.user.first_name }}</h2>
          <div class="profile-tags">
            <span class="profile-tag">
              <i class="fas fa-star"></i>
              Level {{ request.user.customer.loyalty_level }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-item">
        <i class="fas fa-wallet"></i>
        <div class="stat-info">
          <span class="stat-value">{{ request.user.customer.wallet_balance }}</span>
          <span class="stat-label">Credits</span>
        </div>
      </div>
      <div class="stat-item">
        <i class="fas fa-gift"></i>
        <div class="stat-info">
          <span class="stat-value">{{ request.user.customer.reward_points }}</span>
          <span class="stat-label">Points</span>
        </div>
      </div>
    </div>

    <!-- Profile Menu -->
    <div class="profile-menu">
      <a href="#" class="menu-link">
        <i class="fas fa-clock-rotate-left"></i>
        <span>Order History</span>
        <i class="fas fa-chevron-right"></i>
      </a>
      <a href="#" class="menu-link">
        <i class="fas fa-heart"></i>
        <span>Favorites</span>
        <i class="fas fa-chevron-right"></i>
      </a>
      <a href="#" class="menu-link">
        <i class="fas fa-star"></i>
        <span>Reviews</span>
        <i class="fas fa-chevron-right"></i>
      </a>
      <a href="#" class="menu-link">
        <i class="fas fa-gift"></i>
        <span>Rewards</span>
        <i class="fas fa-chevron-right"></i>
      </a>
      <a href="{% url 'customer_signout' %}" class="menu-link menu-link-logout">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
        <i class="fas fa-chevron-right"></i>
      </a>
    </div>
  </div>

  <!-- ===============================
       BOTTOM NAVIGATION
       (Always visible)
  ================================ -->
<!--   <nav class="bottom-nav">
    <div class="fixed-bottom-icons">
      <div class="nav-container">
        <div class="d-flex justify-content-between align-items-center h-100">
          Menu Icon
          <div class="nav-item-wrapper">
            <a href="#" id="ourDishIcon" class="text-inherit d-flex flex-column align-items-center" data-target="menuSection">
              <div class="icon-wrapper">
                <i class="fas fa-home"></i>
              </div>
              <span class="nav-label">Menu</span>
            </a>
          </div>
          Orders Icon
          <div class="nav-item-wrapper">
            <a href="#" id="ordersIcon" class="text-inherit d-flex flex-column align-items-center" data-target="ordersSection">
              <div class="icon-wrapper">
                <i class="fas fa-concierge-bell"></i>
              </div>
              <span class="nav-label">Orders</span>
            </a>
          </div>
          Cart Icon
          <div class="nav-item-wrapper">
            <a data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" href="#" role="button" aria-controls="offcanvasRight" class="text-inherit d-flex flex-column align-items-center">
              <div class="icon-wrapper">
                <i class="fas fa-shopping-cart"></i>
                <span id="cartIconCount"></span>
              </div>
              <span class="nav-label">Cart</span>
            </a>
          </div>
          Profile Icon
          <div class="nav-item-wrapper">
            <a href="#" id="userIcon" class="text-inherit d-flex flex-column align-items-center" data-target="userSection">
              <div class="icon-wrapper">
                <i class="fas fa-user"></i>
              </div>
              <span class="nav-label">Profile</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav> -->
  </section>

  <!-- Reimagined Product Detail Modal with Enhanced Close Button -->
<div class="modal fade" id="productDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content product-modal">
            <button type="button" class="modal-close" data-bs-dismiss="modal" aria-label="Close">
                &times;
            </button>
            <div class="modal-grid">
                <div class="image-section">
                    <img id="detailProductImage" src="/api/placeholder/400/400" alt="Product Image" class="product-image-trigger">
                    <button id="prevProduct" class="nav-btn prev" aria-label="Previous Product">&#10094;</button>
                    <button id="nextProduct" class="nav-btn next" aria-label="Next Product">&#10095;</button>
                </div>

                <div class="info-section">
                    <h2 id="detailProductName">Product Name</h2>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <span>4.5</span>
                    </div>
                    <div class="pricing-container">
                        <div class="pricing">
                            <span id="detailProductPrice" class="current-price">$0</span>
                            <span id="detailProductOldPrice" class="old-price">$0</span>
                        </div>

                        <div class="details-tag" style="display: none;"> <span class="details-ribbon"></span>
                            <button id="infoButton" type="button" class="details-button" disabled> <span class="details-icon">
                                    <i class="fas fa-info-circle"></i>
                                </span>
                                <span class="details-text">Details</span>
                            </button>
                        </div>
                    </div>
                    <div id="specialOfferNote" class="special-offer-note"></div>
                    <div id="modalGSTNote" class="gst-note">
                        <small></small>
                    </div>

                    <div id="detailProductDescriptionContainer" style="display: none;">
                        <p id="detailProductDescription"></p>
                    </div>

                    <div class="controls">
                        <div id="sizeSelectionContainer" class="size-selection" style="display: none;">
                            <button type="button" class="size-btn" data-size="S">S</button>
                            <button type="button" class="size-btn" data-size="M">M</button>
                            <button type="button" class="size-btn" data-size="L">L</button>
                            <button type="button" class="size-btn" data-size="F">F</button>
                        </div>
                        <div class="quantity-control d-none">
                           <button type="button" id="decrement" class="quantity-btn">−</button>
                            <span id="quantityDisplay">1</span>
                            <button type="button" id="increment" class="quantity-btn">+</button>
                        </div>
                    </div>
                     <div class="add-to-cart-container d-none" style="margin-top: 20px; text-align: center;">
                         <button type="button" class="btn btn-primary add-to-cart">Add to Cart</button>
                     </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="popup-backdrop" id="popupBackdrop" style="display: none;"></div>
<div class="description-popup" id="descriptionPopup" style="display: none;">
    <span class="popup-close" id="popupClose">&times;</span>
    <h3 style="margin-bottom: 15px; color: #2c3e50;"></h3> <div id="popupDescription"></div>
</div>
    

<!-- Add this right after the opening <body> tag -->
  <!-- Right after <body> tag -->
<!-- Right after <body> tag -->
<div id="splashScreen" class="splash-screen">
  <div class="splash-content">
    <div class="logo-container">
      <div class="logo-wrapper">
        <!-- Replace the SVG with your image -->
        <img 
          src="../../../static/menu_dashboard/delvrr-logo.JPG" 
          alt="Delvrr Logo" 
          class="logo-image" 
        />
      </div>
    </div>
    <!-- <div class="tagline">Developers © Rimsle</div> -->
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>
</div>












<!-- Beverages Section -->



    <!-- Add an audio element for the click sound -->
    <audio id="clickSound" src="../../../static/menu_dashboard/sounds/click-sound.mp3" preload="auto"></audio>

         

      <!-- Javascript-->
      <!-- Add jQuery library -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

      <!-- Libs JS -->
      <script src="../../../static/menu_dashboard/libs/jquery/dist/jquery.min.js"></script>
      <script src="../../../static/menu_dashboard/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
      <script src="../../../static/menu_dashboard/libs/simplebar/dist/simplebar.min.js"></script>

      <!-- Theme JS -->
      <script src="../../../static/menu_dashboard/js/theme.min.js"></script>

      <script src="../../../static/menu_dashboard/js/vendors/jquery.min.js"></script>
      <script src="../../../static/menu_dashboard/js/vendors/countdown.js"></script>
      <script src="../../../static/menu_dashboard/libs/slick-carousel/slick/slick.min.js"></script>
      <script src="../../../static/menu_dashboard/js/vendors/slick-slider.js"></script>
      <script src="../../../static/menu_dashboard/libs/tiny-slider/dist/min/tiny-slider.js"></script>
      <script src="../../../static/menu_dashboard/js/vendors/tns-slider.js"></script>
      <script src="../../../static/menu_dashboard/js/vendors/zoom.js"></script>
      <script src="../../../static/menu_dashboard/js/sections.js"></script>
      <script src="../../../static/menu_dashboard/js/dinerCount.js"></script>


      <!-- Include other HTML content -->
      <!-- Include jQuery and Bootstrap JS -->
    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

 <!-- JavaScript for handling cart and shake animation with sound -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  document.body.dataset.userEmail = "{{ request.user.email|default:'' }}";
</script>
<script>
  document.body.dataset.userEmail = "{{ request.user.email|default:'' }}";
</script>
<script type="text/javascript">
 $(document).ready(function () {
  // Initialize the cart object
  let cart = {};

  // Get current user info from the page
  const currentUser = document.body.dataset.userEmail || null;

  // Create toast container if it doesn't exist (positioned at the bottom right)
  if (!$('#toastContainer').length) {
    $('body').append('<div id="toastContainer" style="position: fixed; bottom: 24px; right: 24px; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end;"></div>');
  }

  // Function to get cart with user validation
  function getStoredCart() {
    const storedCart = localStorage.getItem('cart');
    const storedCartUser = localStorage.getItem('cartUser');

    if (storedCart && storedCartUser === currentUser) {
      return JSON.parse(storedCart);
    }
    return {};
  }

  // Function to save cart with user association
  function saveCart(cartData) {
    localStorage.setItem('cart', JSON.stringify(cartData));
    localStorage.setItem('cartUser', currentUser);
  }

  // Function to clear cart
  function clearCart() {
    localStorage.removeItem('cart');
    localStorage.removeItem('cartUser');
    cart = {};
    updateCart(cart);
  }

  // Check for logout signal
  if (document.cookie.includes('clear_cart=true')) {
    clearCart();
    // Clear the cookie
    document.cookie = 'clear_cart=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
  }

  // Initialize cart from storage with user validation
  cart = getStoredCart();
  updateCart(cart);

  // Function to show product toast (your original design with bottom-right positioning)
  function showProductToast(product, type = 'success') {
    const toastId = 'toast-' + Date.now();
    const config = {
      success: {
        message: 'Added',
        icon: 'fa-check',
        color: '#f7c028',
        borderColor: '#e9ecef',
        bgColor: '#FFFFFF'
      },
      error: {
        message: 'Removed',
        icon: 'fa-times',
        color: '#f44336',
        borderColor: '#e9ecef',
        bgColor: '#FFFFFF'
      },
      warning: {
        message: 'Updated',
        icon: 'fa-exclamation',
        color: '#ff9800',
        borderColor: '#e9ecef',
        bgColor: '#FFFFFF'
      }
    };

    const toastConfig = config[type];

    // Insert keyframes if not already added
    if (!document.querySelector('#toastKeyframes')) {
      const keyframes = `
        @keyframes slideInBottomRight {
          0% { transform: translateX(20px) translateY(20px); opacity: 0; }
          100% { transform: translateX(0) translateY(0); opacity: 1; }
        }
        @keyframes fadeOutBottomRight {
          0% { transform: translateX(0) translateY(0); opacity: 1; }
          100% { transform: translateX(20px) translateY(20px); opacity: 0; }
        }
        @keyframes popIn {
          0% { transform: scale(0.8); opacity: 0; }
          40% { transform: scale(1.1); opacity: 1; }
          100% { transform: scale(1); opacity: 1; }
        }
      `;
      const style = document.createElement('style');
      style.id = 'toastKeyframes';
      style.innerHTML = keyframes;
      document.head.appendChild(style);
    }

    const toast = $(`
      <div id="${toastId}" style="
        width: 180px;
        margin-top: 6px;
        background-color: ${toastConfig.bgColor};
        color: #1F2937;
        padding: 8px;
        border-radius: 6px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        opacity: 0;
        animation: slideInBottomRight 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        border: 1px solid ${toastConfig.borderColor};
        overflow: hidden;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 8px;
      ">
        <div style="
          width: 36px;
          height: 36px;
          border-radius: 4px;
          overflow: hidden;
          flex-shrink: 0;
        ">
          ${product.image ?
            `<img src="${product.image}" style="width: 100%; height: 100%; object-fit: cover;" alt="${product.name}">` :
            `<div style="width: 100%; height: 100%; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center;">
              <i class="fas fa-utensils" style="color: #6c757d;"></i>
            </div>`
          }
        </div>

        <div style="flex-grow: 1; display: flex; flex-direction: column;">
          <div style="font-weight: 600; font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${product.name}</div>
          <div style="display: flex; align-items: center; gap: 4px;">
            <span style="color: ${toastConfig.color}; font-weight: 600; font-size: 0.75rem; display: flex; align-items: center; gap: 2px;">
              <i class="fas ${toastConfig.icon}" style="font-size: 0.7rem;"></i>
              ${toastConfig.message}
            </span>
          </div>
        </div>
      </div>
    `);

    $('#toastContainer').prepend(toast);

    // Automatically dismiss after 1.5 seconds
    setTimeout(() => {
      dismissProductToast(toastId);
    }, 1500);
  }

  function dismissProductToast(toastId) {
    const toast = $(`#${toastId}`);
    toast.css({
      'animation': 'fadeOutBottomRight 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards'
    });
    setTimeout(() => {
      toast.remove();
    }, 200);
  }

  // Function to update the cart content
  function updateCart(cart) {
    let totalItems = 0;
    let subtotal = 0.0;
    let cartItemsHtml = '';

    if (Object.keys(cart).length === 0) {
      $('#cartItems').html(`
        <div class="empty-state">
          <i class="fas fa-shopping-cart fa-2x" style="color: white !important; margin-bottom: 0.75rem;"></i>
          <p style="color: #4B5563; font-size: 0.875rem;">Your cart is empty</p>
        </div>
      `);
      // Update cart count with number only
      $('[id="cartIconCount"]').text('0').addClass('d-none');
      $('#cartTotal').text('$0.00');
      $('#checkoutButton').addClass('d-none');
      saveCart(cart);
      return;
    }

    for (let itemId in cart) {
      let [quantity, productName, productPrice, productImage] = cart[itemId];
      totalItems += quantity;
      subtotal += quantity * productPrice;

      cartItemsHtml += `
        <div class="cart-item" data-item-id="${itemId}">
          <img src="${productImage}" alt="${productName}" class="cart-item-image">
          <div class="cart-item-details">
            <div class="cart-item-name">${productName}</div>
            <div class="cart-item-price">$${productPrice.toFixed(2)}</div>
            <div class="quantity-controls">
              <button class="quantity-btn decrement" data-product-id="${itemId}" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <span class="quantity-value">${quantity}</span>
              <button class="quantity-btn increment" data-product-id="${itemId}" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
            </div>
          </div>
          <button class="remove-item" data-product-id="${itemId}" aria-label="Remove item" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
          </button>
        </div>`;
    }

    $('#cartItems').html(cartItemsHtml);

    // Update cart count with number only - removed "Items" text
    $('[id="cartIconCount"]').text(totalItems).removeClass('d-none');

    $('#cartTotal').text(`$${subtotal.toFixed(2)}`);
    $('#checkoutButton').removeClass('d-none');
    saveCart(cart);

    // Re-bind event handlers after updating the DOM
    bindCartEvents();
  }

  // Function to bind cart event handlers
  function bindCartEvents() {
    // Handle increment button clicks
    $('.increment').off('click').on('click', function() {
      const productId = $(this).data('product-id');
      if (!cart[productId]) return;

      const productName = cart[productId][1];
      const productPrice = cart[productId][2];
      const productImage = cart[productId][3];

      cart[productId][0]++;

      showProductToast({
        name: productName,
        image: productImage,
        price: '$' + productPrice.toFixed(2)
      }, 'success');

      updateCart(cart);
    });

    // Handle decrement button clicks
    $('.decrement').off('click').on('click', function() {
      const productId = $(this).data('product-id');
      if (!cart[productId]) return;

      const productName = cart[productId][1];
      const productPrice = cart[productId][2];
      const productImage = cart[productId][3];

      const productObject = {
        name: productName,
        image: productImage,
        price: '$' + productPrice.toFixed(2)
      };

      if (cart[productId][0] > 1) {
        cart[productId][0]--;
        showProductToast(productObject, 'warning');
      } else {
        delete cart[productId];
        showProductToast(productObject, 'error');
      }

      updateCart(cart);
    });

    // Handle remove item button clicks
    $('.remove-item').off('click').on('click', function() {
      const productId = $(this).data('product-id');
      if (!cart[productId]) return;

      const productName = cart[productId][1];
      const productPrice = cart[productId][2];
      const productImage = cart[productId][3];

      showProductToast({
        name: productName,
        image: productImage,
        price: '$' + productPrice.toFixed(2)
      }, 'error');

      delete cart[productId];
      updateCart(cart);
    });
  }

  // Handle add-to-cart button clicks from product cards
  $(document).on('click', '.add-to-cart-btn, .add-to-cart', function (e) {
    e.preventDefault();

    // Find the closest product container (dish-card or food-item)
    const productCard = $(this).closest('.dish-card, .food-item');
    const productId = productCard.data('product-id');
    const productName = productCard.data('name');

    // Improved price parsing to handle currency symbols and formatting
    let priceValue = productCard.data('price');
    // If price is a string that starts with a currency symbol, remove it
    if (typeof priceValue === 'string') {
      priceValue = priceValue.replace(/^[$£€¥]/, '').trim();
    }
    // Parse the cleaned price value to float
    const productPrice = parseFloat(priceValue);

    const productImage = productCard.data('image');

    // Check if we got all the required data
    if (!productId || !productName || isNaN(productPrice) || !productImage) {
      console.error('Missing product data:', { productId, productName, productPrice, productImage, rawPrice: productCard.data('price') });
      return;
    }

    const productObject = {
      id: productId,
      name: productName,
      price: '$' + productPrice.toFixed(2),
      image: productImage
    };

    showProductToast(productObject, 'success');

    if (!cart[productId]) {
      cart[productId] = [1, productName, productPrice, productImage];
    } else {
      cart[productId][0]++;
    }

    updateCart(cart);
  });

  // Handle checkout button click - MODIFIED TO FIX CHECKOUT ISSUE
    $('#checkoutButton').off('click').on('click', function(e) {
  e.preventDefault(); // in case this ever lives inside a form

  // grab the full URL you rendered with both slug & hash
  const checkoutUrl = $('#checkoutButton').data('checkoutUrl');

  console.log('Redirecting to:', checkoutUrl);

  if (checkoutUrl) {
    saveCart(cart);
    window.location.href = checkoutUrl;
  } else {
    console.error('Unable to get checkout URL');
    showProductToast({
      name: 'Error: Unable to checkout',
      image: null
    }, 'error');
  }
});

  // Initial binding of event handlers
  bindCartEvents();
});
</script>









<!-- <script>
// Enhanced Navigation Behavior
document.addEventListener('DOMContentLoaded', function() {
    // Navigation setup
    const navItems = document.querySelectorAll('.text-inherit');
    const highlight = document.querySelector('.nav-pill-highlight');

    navItems.forEach((item, index) => {
        item.addEventListener('click', (e) => {
            // Skip if it's the cart icon (to maintain offcanvas functionality)
            if (!item.hasAttribute('data-bs-toggle')) {
                e.preventDefault();
                
                // Remove active class from all items
                navItems.forEach(i => i.classList.remove('active'));
                
                // Add active class to clicked item
                item.classList.add('active');
                
                // Move highlight pill
                highlight.style.transform = `translateX(${index * 100}%)`;
            }
        });
    });

    // Scroll behavior
    let lastScrollY = window.scrollY;
    let scrollTimer = null;
    
    const handleScroll = () => {
        const currentScrollY = window.scrollY;
        const bottomNav = document.querySelector('.fixed-bottom-icons');
        
        // Clear existing timer
        if (scrollTimer !== null) {
            clearTimeout(scrollTimer);
        }

        // Show/hide based on scroll direction
        if (currentScrollY > lastScrollY && currentScrollY > 50) {
            bottomNav.classList.add('hidden');
        } else {
            bottomNav.classList.remove('hidden');
        }

        // Set timer to show elements after scrolling stops
        scrollTimer = setTimeout(() => {
            bottomNav.classList.remove('hidden');
        }, 1000);

        lastScrollY = currentScrollY;
    };

    // Throttle scroll event
    let ticking = false;
    window.addEventListener('scroll', () => {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                handleScroll();
                ticking = false;
            });
            ticking = true;
        }
    });

    // Set initial active state
    if (!document.querySelector('.text-inherit.active')) {
        navItems[0].classList.add('active');
    }
});
</script> -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Cache DOM elements
    const ordersIcon = document.getElementById('ordersIcon');
    const ordersModal = document.getElementById('ordersFullscreen');
    const chatMessages = document.querySelector('.chat-messages');
    const messageInput = document.querySelector('#messageInput');
    const sendButton = document.querySelector('#sendButton');

    // Set up modal triggers
    ordersIcon.setAttribute('data-bs-toggle', 'modal');
    ordersIcon.setAttribute('data-bs-target', '#ordersFullscreen');

    // Handle modal events
    ordersModal.addEventListener('hidden.bs.modal', function () {
        document.getElementById('ourDishSection').style.display = 'block';
    });

    ordersModal.addEventListener('shown.bs.modal', function () {
        document.getElementById('ourDishSection').style.display = 'none';
        scrollToBottom();
        messageInput.focus();
    });

    // Scroll to bottom function
    function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Create message HTML without timestamp
    function createMessageHTML(message, type = 'customer') {       
        if (type === 'customer') {
            return `
                <div class="message customer-message">
                    <div class="message-content">
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }
        
        return `
            <div class="message restaurant-message">
                <div class="message-content">
                    <div class="sender-name mb-1 text-muted small">Restaurant Staff</div>
                    <p>${message}</p>
                </div>
            </div>
        `;
    }

    // Send message function
    function sendMessage() {
        const message = messageInput.value.trim();
        if (message) {
            // Add customer message
            chatMessages.insertAdjacentHTML('beforeend', createMessageHTML(message));
            messageInput.value = '';
            scrollToBottom();
            
            // Simulate restaurant response after a delay
            setTimeout(() => {
                const responses = [
                    "We've noted your request. Your order will be prepared accordingly.",
                    "Thank you for letting us know. We'll take care of that.",
                    "Got it! We'll add that to your order.",
                    "Your request has been passed to the kitchen."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                chatMessages.insertAdjacentHTML('beforeend', createMessageHTML(randomResponse, 'restaurant'));
                scrollToBottom();
            }, 1000);
        }
    }

    // Event listeners
    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    // Handle message input animations
    messageInput.addEventListener('focus', function() {
        this.closest('.input-group').style.boxShadow = '0 0 0 2px rgba(255, 193, 7, 0.25)';
    });

    messageInput.addEventListener('blur', function() {
        this.closest('.input-group').style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
    });
});
</script>


<!-- JavaScript for Sliding Navigation -->
<!-- Add JavaScript for toggling the description -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Modal Element References ---
    const productModal = document.getElementById('productDetailModal');
    const modalImage = document.getElementById('detailProductImage');
    const modalName = document.getElementById('detailProductName');
    const modalPrice = document.getElementById('detailProductPrice');
    const modalOldPrice = document.getElementById('detailProductOldPrice');
    const modalDescription = document.getElementById('detailProductDescription');
    const modalDescriptionContainer = document.getElementById('detailProductDescriptionContainer');
    const specialOfferNote = document.getElementById('specialOfferNote');
    const modalGSTNote = document.getElementById('modalGSTNote');
    const infoButton = document.getElementById('infoButton');
    const detailsTag = document.querySelector('.details-tag'); // Get the entire details tag container

    // --- Other variable declarations remain the same ---
    const sizeSelectionContainer = document.getElementById('sizeSelectionContainer');
    const sizeButtons = productModal ? productModal.querySelectorAll('.size-btn') : [];
    const quantityDisplay = document.getElementById('quantityDisplay');
    const decrementBtn = document.getElementById('decrement');
    const incrementBtn = document.getElementById('increment');
    let quantity = 1;
    const popupBackdrop = document.getElementById('popupBackdrop');
    const descriptionPopup = document.getElementById('descriptionPopup');
    const popupDescription = document.getElementById('popupDescription');
    const popupClose = document.getElementById('popupClose');

    // --- Initial Setup ---
    if (sizeSelectionContainer) {
        sizeSelectionContainer.style.display = 'none';
    }

    // Force hide the details tag on page load
    if (detailsTag) {
        detailsTag.style.display = 'none';
    }

    // --- Quantity Control Logic remains the same ---
    if (decrementBtn && incrementBtn && quantityDisplay) {
        decrementBtn.addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                quantityDisplay.textContent = quantity;
            }
        });

        incrementBtn.addEventListener('click', () => {
            quantity++;
            quantityDisplay.textContent = quantity;
        });
    }

    // --- Function to Open and Populate the Main Product Modal ---
    function openProductDetailModal(productElement) {
        if (!productElement || !productModal) return;

        // --- Get Data from clicked element ---
        const productName = productElement.dataset.name || 'Product Name';
        const productImage = productElement.dataset.image || 'default-image.jpg';
        const basePrice = productElement.dataset.price || '$0.00';
        const previousPrice = productElement.dataset.previousPrice;
        const hasVariations = productElement.dataset.hasVariations === "true";
        const isPriceByPercentage = productElement.dataset.priceByPercentage === "true";
        const specialOffer = productElement.dataset.specialOffer;
        const productDescription = productElement.dataset.description || "";
        const gstNote = productElement.dataset.gst;

        // --- Populate Modal Elements ---
        if (modalImage) modalImage.src = productImage;
        if (modalName) modalName.textContent = productName;

        // --- Handle Description - IMPROVED LOGIC ---
        // Check for empty description - use strict checking
        const hasDescription = Boolean(productDescription && productDescription.trim() !== "");
        
        // Log for debugging
        console.log(`Product "${productName}" description check:`, {
            hasDescription: hasDescription,
            description: productDescription,
            isEmpty: productDescription === "",
            isWhitespace: productDescription && productDescription.trim() === ""
        });
        
        // Reset description text
        if (modalDescription) {
            modalDescription.textContent = productDescription || "";
        }
        
        // Hide description container in main modal 
        if (modalDescriptionContainer) {
            modalDescriptionContainer.style.display = 'none';
        }
        
        // CRITICAL FIX: Handle details tag visibility with forced styling
        if (detailsTag) {
            // Force-hide the details tag by default
            detailsTag.style.display = 'none';
            
            // Only show it if there's an actual description
            if (hasDescription) {
                detailsTag.style.display = 'block';
            }
            
            // Update data attribute for CSS targeting if needed
            detailsTag.setAttribute('data-has-description', hasDescription ? 'true' : 'false');
        }
        
        // Ensure the info button state matches
        if (infoButton) {
            infoButton.disabled = !hasDescription;
            
            if (!hasDescription) {
                infoButton.classList.add('disabled');
            } else {
                infoButton.classList.remove('disabled');
            }
        }

        // --- Rest of function remains the same ---
        // --- Handle Pricing ---
        const priceS = productElement.dataset.priceS || basePrice;
        const priceM = productElement.dataset.priceM || basePrice;
        const priceL = productElement.dataset.priceL || basePrice;
        const priceF = productElement.dataset.priceF || basePrice;

        const defaultPrice = hasVariations ? priceS : basePrice;
        if (modalPrice) modalPrice.textContent = defaultPrice;

        // Old Price (Strikethrough)
        if (modalOldPrice) {
            if (previousPrice && !isPriceByPercentage) {
                modalOldPrice.textContent = `$${previousPrice}`;
                modalOldPrice.style.display = 'inline';
            } else {
                modalOldPrice.style.display = 'none';
            }
        }

        // --- Handle Special Offer Note ---
        if (specialOfferNote) {
            if (specialOffer) {
                specialOfferNote.textContent = specialOffer;
                specialOfferNote.style.display = 'block';
            } else {
                specialOfferNote.style.display = 'none';
            }
        }

        // --- Handle GST Note ---
        if (modalGSTNote) {
            if (gstNote) {
                const smallTag = modalGSTNote.querySelector('small');
                if(smallTag) smallTag.textContent = gstNote;
                modalGSTNote.style.display = 'block';
            } else {
                modalGSTNote.style.display = 'none';
            }
        }

        // --- Reset Quantity ---
        quantity = 1;
        if(quantityDisplay) quantityDisplay.textContent = quantity;

        // --- Handle Size Variations ---
        if (sizeButtons.length > 0 && sizeSelectionContainer) {
            sizeButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.disabled = false;
                btn.removeAttribute('data-price');
            });

            if (hasVariations) {
                sizeSelectionContainer.style.display = 'flex';

                sizeButtons.forEach(button => {
                    const size = button.dataset.size;
                    let price = basePrice;

                    switch (size) {
                        case 'S': price = priceS; button.classList.add('active'); break;
                        case 'M': price = priceM; break;
                        case 'L': price = priceL; break;
                        case 'F': price = priceF; break;
                    }
                    
                    if (!price || price === basePrice && size !== 'S') {
                        // button.disabled = true;
                    }

                    button.setAttribute('data-price', price);
                });
            } else {
                sizeSelectionContainer.style.display = 'none';
            }
        }

        if(productModal) productModal.setAttribute('data-price-by-percentage', isPriceByPercentage);

        // --- Show the Bootstrap Modal ---
        try {
            if (window.jQuery && window.jQuery.fn.modal) {
                $(productModal).modal('show');
            } else if (window.bootstrap && window.bootstrap.Modal) {
                const modalInstance = bootstrap.Modal.getOrCreateInstance(productModal);
                modalInstance.show();
            } else {
                console.error("Bootstrap Modal function not found.");
            }
        } catch (error) {
            console.error("Error showing modal:", error);
        }
    }

    // --- Event Listener for clicking on a product item ---
    const menuContent = document.getElementById('menuContent');
    if (menuContent) {
        menuContent.addEventListener('click', function(event) {
            const foodItem = event.target.closest('.food-item');
            if (foodItem && !event.target.closest('.add-to-cart')) {
                openProductDetailModal(foodItem);
            }
        });
    } else {
        console.warn("Element with ID 'menuContent' not found. Product click listener not attached.");
    }

    // --- Event Listener for Size Button Clicks ---
    if (sizeButtons.length > 0 && modalPrice) {
        sizeButtons.forEach(button => {
            button.addEventListener('click', function() {
                if (!this.disabled) {
                    sizeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    const newPrice = this.getAttribute('data-price');
                    if (newPrice) {
                        modalPrice.textContent = newPrice;
                    }
                }
            });
        });
    }

    // --- Event Listeners for Closing the Main Modal ---
    if (productModal) {
        const closeBtns = productModal.querySelectorAll('.close-btn, [data-bs-dismiss="modal"]');
        closeBtns.forEach(closeBtn => {
            closeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                try {
                    if (window.bootstrap && window.bootstrap.Modal) {
                        const modalInstance = bootstrap.Modal.getInstance(productModal);
                        if (modalInstance) {
                            modalInstance.hide();
                            return;
                        }
                    }
                    
                    if (window.jQuery && window.jQuery.fn.modal) {
                        $(productModal).modal('hide');
                        return;
                    }
                    
                    productModal.classList.remove('show');
                    productModal.style.display = 'none';
                    document.body.classList.remove('modal-open');
                    const backdrop = document.querySelector('.modal-backdrop');
                    if (backdrop) backdrop.remove();
                } catch (error) {
                    console.error('Error closing modal:', error);
                }
            });
        });

        productModal.addEventListener('hidden.bs.modal', function () {
            console.log('Main modal hidden via Bootstrap event');
            if(infoButton) infoButton.classList.remove('glowing');
            if(popupBackdrop) popupBackdrop.style.display = 'none';
            if(descriptionPopup) descriptionPopup.style.display = 'none';
        });
    }

    // --- Event Listeners for the Description Popup ---
    if (infoButton && popupBackdrop && descriptionPopup && popupDescription && popupClose && modalDescription) {
        // Open Popup - with thorough validation
        infoButton.addEventListener('click', function(e) {
            // Prevent default to avoid any navigation
            e.preventDefault();
            e.stopPropagation();
            
            // Don't proceed if button is disabled
            if (this.disabled) {
                return;
            }
            
            // Get the description text
            const descriptionText = modalDescription.textContent || "";
            
            // Only show popup if there's actual content
            if (descriptionText && descriptionText.trim() !== "") {
                popupDescription.textContent = descriptionText;
                popupBackdrop.style.display = 'block';
                descriptionPopup.style.display = 'block';
            } else {
                console.log("No description content to show in popup");
            }
        });

        // Close Popup via Close Button (X)
        popupClose.addEventListener('click', function() {
            popupBackdrop.style.display = 'none';
            descriptionPopup.style.display = 'none';
        });

        // Close Popup via Backdrop Click
        popupBackdrop.addEventListener('click', function() {
            popupBackdrop.style.display = 'none';
            descriptionPopup.style.display = 'none';
        });
    } else {
        console.warn("One or more elements for the description popup functionality were not found.");
    }
});
</script>






<!-- ===============================
     JAVASCRIPT TO TOGGLE SECTIONS
=============================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Select all main sections using the common class
    const sections = document.querySelectorAll('.menu-app-container');
    // Select all navigation icons from the bottom nav
    const navIcons = document.querySelectorAll('.bottom-nav .nav-item-wrapper a');

    // Function to hide all sections by adding the .hidden class
    function hideAllSections() {
      sections.forEach(section => section.classList.add('hidden'));
    }

    // Function to show a specific section by removing the .hidden class
    function showSection(sectionId) {
      hideAllSections();
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.remove('hidden');
      }
    }

    // Function to reset the active state of nav icons
    function resetActiveStates() {
      navIcons.forEach(icon => {
        icon.classList.remove('active');
        const label = icon.querySelector('.nav-label');
        if (label) {
          label.classList.remove('active');
        }
      });
    }

    // Initialize: show the menuSection by default and set the Home icon as active
    hideAllSections();
    showSection('menuSection');
    document.getElementById('ourDishIcon').classList.add('active');
    document.querySelector('#ourDishIcon .nav-label').classList.add('active');

    // Add click event handlers to the navigation icons
    navIcons.forEach(icon => {
      icon.addEventListener('click', function(e) {
        e.preventDefault(); // Prevent default anchor behavior
        const targetSection = this.getAttribute('data-target') || 'menuSection';
        resetActiveStates();
        showSection(targetSection);
        this.classList.add('active');
        const label = this.querySelector('.nav-label');
        if (label) {
          label.classList.add('active');
        }
      });
    });

    // When the Orders modal is closed (via the X button), revert back to the Home section.
    // This uses Bootstrap's "hidden.bs.modal" event.
    var ordersModalEl = document.getElementById('ordersFullscreen');
    if (ordersModalEl) {
      ordersModalEl.addEventListener('hidden.bs.modal', function() {
        resetActiveStates();
        showSection('menuSection');
        const homeIcon = document.getElementById('ourDishIcon');
        homeIcon.classList.add('active');
        const homeLabel = homeIcon.querySelector('.nav-label');
        if (homeLabel) {
          homeLabel.classList.add('active');
        }
      });
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const splashScreen = document.getElementById('splashScreen');
    
    // Show splash screen for 3 seconds, then fade out
    setTimeout(() => {
      splashScreen.classList.add('fade-out');
      setTimeout(() => {
        splashScreen.remove();
      }, 500);
    }, 3000);
  });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categoryScroll = document.querySelector('.category-scroll');
        const categoryButtons = document.querySelectorAll('.category-btn');
        
        // Handle button click
        categoryButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Scroll into view (centered)
                const scrollContainer = categoryScroll;
                const buttonLeft = this.offsetLeft;
                const buttonWidth = this.offsetWidth;
                const containerWidth = scrollContainer.clientWidth;
                
                const targetScrollLeft = buttonLeft - (containerWidth / 2) + (buttonWidth / 2);
                scrollContainer.scrollTo({ left: targetScrollLeft, behavior: 'smooth' });
                
                // Handle category change logic here
                const categoryName = this.dataset.category;
                // Your category change logic...
            });
        });
        
        // Mouse drag scrolling
        let isDown = false;
        let startX;
        let scrollLeft;
        
        categoryScroll.addEventListener('mousedown', (e) => {
            isDown = true;
            categoryScroll.classList.add('dragging');
            startX = e.pageX - categoryScroll.offsetLeft;
            scrollLeft = categoryScroll.scrollLeft;
        });
        
        categoryScroll.addEventListener('mouseleave', () => {
            isDown = false;
            categoryScroll.classList.remove('dragging');
        });
        
        categoryScroll.addEventListener('mouseup', () => {
            isDown = false;
            categoryScroll.classList.remove('dragging');
        });
        
        categoryScroll.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - categoryScroll.offsetLeft;
            const walk = (x - startX) * 1.5; // Scroll speed multiplier
            categoryScroll.scrollLeft = scrollLeft - walk;
        });
        
        // Touch drag scrolling (mobile)
        let touchStartX;
        let touchScrollLeft;
        
        categoryScroll.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].pageX - categoryScroll.offsetLeft;
            touchScrollLeft = categoryScroll.scrollLeft;
        }, { passive: true });
        
        categoryScroll.addEventListener('touchmove', (e) => {
            const x = e.touches[0].pageX - categoryScroll.offsetLeft;
            const walk = (x - touchStartX) * 1.5;
            categoryScroll.scrollLeft = touchScrollLeft - walk;
        }, { passive: true });
        
        // Auto-scroll to active button on page load
        const activeButton = document.querySelector('.category-btn.active');
        if (activeButton) {
            const scrollContainer = categoryScroll;
            const buttonLeft = activeButton.offsetLeft;
            const buttonWidth = activeButton.offsetWidth;
            const containerWidth = scrollContainer.clientWidth;
            
            // Center the active button
            const targetScrollLeft = buttonLeft - (containerWidth / 2) + (buttonWidth / 2);
            scrollContainer.scrollLeft = targetScrollLeft;
        }
    });
    </script>

<!-- Search features -->
<!-- Place this script in your HTML, ideally before the closing </body> tag -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Modal element references
  const productDetailModalElement = document.getElementById('productDetailModal');
  const detailDescriptionContainer = document.getElementById('detailProductDescriptionContainer');
  const productDetailModal = new bootstrap.Modal(productDetailModalElement);
  const detailImage = document.getElementById('detailProductImage');
  const detailName = document.getElementById('detailProductName');
  const detailPrice = document.getElementById('detailProductPrice');
  const detailOldPrice = document.getElementById('detailProductOldPrice');
  const detailDescription = document.getElementById('detailProductDescription'); // For hidden text
  const quantityDisplay = document.getElementById('quantityDisplay');
  const prevBtn = document.getElementById('prevProduct');
  const nextBtn = document.getElementById('nextProduct');
  const modalGSTNote = document.getElementById('modalGSTNote');
  const specialOfferNote = document.getElementById('specialOfferNote');
  const infoButton = document.getElementById('infoButton'); // <<< ADDED LINE
  const detailsTag = document.querySelector('#productDetailModal .details-tag'); // <<< ADD THIS SELECTOR

  const originalUpdateModalContent = updateModalContent;
    updateModalContent = function(newIndex) {
      originalUpdateModalContent(newIndex);
      preloadModalImages();
    };
const imageStyles = document.createElement('style');
imageStyles.textContent = `
  .grid-image-container {
    position: relative;
    overflow: hidden;
    background-color: #f8f8f8;
    border-radius: 8px;
  }
  
  .image-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f0f0;
    z-index: 1;
    transition: opacity 0.3s ease;
  }
  
  .loading-spinner {
    width: 30px;
    height: 30px;
    border: 3px solid rgba(70, 130, 180, 0.2);
    border-radius: 50%;
    border-top-color: #4682B4;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .grid-image {
    position: relative;
    z-index: 2;
    transition: opacity 0.3s ease;
  }
  
  .grid-image.loading {
    opacity: 0;
  }
  
  .grid-image.loaded {
    opacity: 1;
  }
`;
document.head.appendChild(imageStyles);

  // Global state
  let quantity = 2;
  let currentIndex = 0;
  let products = [];
  let modalProducts = [];
  let lastSelectedCategory = 'featured';

  // Initialize products from carousel items
   const carouselItems = Array.from(document.querySelectorAll('.food-item'));
    products = carouselItems.map(card => ({
      id: card.dataset.productId,
      name: card.dataset.name,
      description: card.dataset.description || '',
      price: card.dataset.price,
      previousPrice: card.dataset.previousPrice || '',
      image: card.dataset.image,         // should be 400×400 thumbnail URL
      category: card.dataset.category || 'featured',
      status: card.querySelector('.discount-badge') ? 'Sale' : 'Regular',
      hasVariations: card.dataset.hasVariations === 'true',
      priceS: card.dataset.priceS,
      priceM: card.dataset.priceM,
      priceL: card.dataset.priceL,
      priceF: card.dataset.priceF,
      gst: card.dataset.gst || '',
      specialOffer: card.dataset.specialOffer || '',
      priceByPercentage: card.dataset.priceByPercentage === 'true'
    }));

  // Helper: get whichever items are currently visible
  function getVisibleProducts() {
      const container = document.querySelector('.featured-section').style.display !== 'none'
        ? '.featured-section .food-item'
        : '.grid-item';
      return Array.from(document.querySelectorAll(container)).map(item => ({
        id: item.dataset.productId,
        name: item.dataset.name,
        description: item.dataset.description || '',
        price: item.dataset.price,
        previousPrice: item.dataset.previousPrice || '',
        image: item.dataset.image,
        category: item.dataset.category || 'featured',
        status: item.querySelector('.discount-badge') ? 'Sale' : 'Regular',
        hasVariations: item.dataset.hasVariations === 'true',
        priceS: item.dataset.priceS,
        priceM: item.dataset.priceM,
        priceL: item.dataset.priceL,
        priceF: item.dataset.priceF,
        gst: item.dataset.gst || '',
        specialOffer: item.dataset.specialOffer || '',
        priceByPercentage: item.dataset.priceByPercentage === 'true'
      }));
    }

  // Update modal content with fade-in effect
  // Find this function in your code and replace it with this fixed version:
function updateModalContent(newIndex) {
    if (!modalProducts.length || newIndex < 0 || newIndex >= modalProducts.length) {
        console.error("Invalid index or modalProducts empty:", newIndex, modalProducts);
        return;
    }
    const product = modalProducts[newIndex];

    // --- Image ---
    if (detailImage) {
        detailImage.style.opacity = '0'; // Start fade out
        detailImage.src = product.image || "/api/placeholder/400/400"; // Set new image source with fallback
        // Add onload handler for fade-in *after* setting src
        detailImage.onload = function() {
            detailImage.style.transition = 'opacity 0.3s ease-in-out'; // Ensure transition is set
            detailImage.style.opacity = '1'; // Fade in
            detailImage.onload = null; // Clean up handler
        };
        // Handle potential loading errors
        detailImage.onerror = function() {
            console.error("Error loading image:", detailImage.src);
            detailImage.src = "/api/placeholder/400/400"; // Fallback image on error
            detailImage.style.opacity = '1'; // Show fallback immediately
            detailImage.onerror = null;
        }
    }

    // --- Name ---
    if (detailName) detailName.textContent = product.name || "Product Name"; // Add fallback

    // --- Description Handling ---
    const productDescriptionValue = product.description || ""; // Get description or empty string
    const hasDescription = productDescriptionValue && productDescriptionValue.trim() !== '';

    console.log(`--- Running updateModalContent for: ${product.name} ---`);
    console.log(`   Raw description from product object: "${productDescriptionValue}"`);
    console.log(`   Calculated hasDescription: ${hasDescription}`);
    
    // IMPORTANT: First, verify our elements exist
    const detailsTagElement = document.querySelector('#productDetailModal .details-tag');
    const infoButtonElement = document.getElementById('infoButton');
    
    console.log(`   Is detailsTag element available? ${!!detailsTagElement}`);
    console.log(`   Is infoButton element available? ${!!infoButtonElement}`);

    // 1. Store description text in the hidden paragraph (for the popup)
    if (detailDescription) {
        detailDescription.textContent = productDescriptionValue; // Use the retrieved value
    }

    // 2. Control visibility of the details-tag container AND disabled state of the button
    // FIXED: Always directly set the style properties rather than toggling classes
    if (detailsTagElement) {
        if (hasDescription) {
            // Show the container 
            console.log(`   >>> Setting detailsTag display to 'block'`);
            detailsTagElement.style.display = 'block'; // Force display block
            
            // Make sure button is enabled if it exists
            if (infoButtonElement) {
                infoButtonElement.disabled = false;
            }
        } else {
            // Hide the container
            console.log(`   >>> Setting detailsTag display to 'none'`);
            detailsTagElement.style.display = 'none'; // Force display none
            
            // Disable button if it exists
            if (infoButtonElement) {
                infoButtonElement.disabled = true;
            }
        }
    } else {
        console.error("MODAL DEBUG: Could not find .details-tag element in modal.");
    }

    // 3. Ensure the explicit description container in the main modal remains hidden
    if (detailDescriptionContainer) {
        detailDescriptionContainer.style.display = 'none';
    }

    // --- Quantity ---
    quantity = 1; // Reset to 1 when content changes
    if (quantityDisplay) quantityDisplay.textContent = quantity;

    const sizeSelection = document.getElementById('sizeSelectionContainer');
const sizeButtons = sizeSelection?.querySelectorAll('.size-btn') || [];
if (sizeSelection) {
    if (product.hasVariations) {
        sizeSelection.style.display = 'flex';
        sizeSelection.classList.remove('d-none');

        sizeButtons.forEach(button => {
            const size = button.dataset.size;
            let priceForSize = '';
            let isActive = false;

            // Assign price based on size
            switch (size) {
                case 'S': priceForSize = product.priceS; isActive = true; break; // Default active
                case 'M': priceForSize = product.priceM; break;
                case 'L': priceForSize = product.priceL; break;
                case 'F': priceForSize = product.priceF; break;
            }
            priceForSize = priceForSize || product.price; // Fallback to base price if size price missing

            // Update button state
            button.disabled = !priceForSize;
            button.dataset.price = priceForSize;
            button.classList.toggle('active', isActive);

            // Click handler updates price
            button.onclick = function() {
                if (!this.disabled) {
                    sizeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    if (detailPrice && !(product.specialOffer && product.specialOffer.trim())) {
                        let displayPrice = this.dataset.price;
                        if (!product.priceByPercentage && displayPrice && !displayPrice.startsWith('$')) {
                            displayPrice = `$${displayPrice}`;
                        }
                        detailPrice.textContent = displayPrice || '';
                    }
                }
            };
        });

        // Initially display default (S) price
        if (detailPrice && !(product.specialOffer && product.specialOffer.trim())) {
            let initialDisplayPrice = product.priceS || product.price;
            if (!product.priceByPercentage && initialDisplayPrice && !initialDisplayPrice.startsWith('$')) {
                initialDisplayPrice = `$${initialDisplayPrice}`;
            }
            detailPrice.textContent = initialDisplayPrice || '';
        }

    } else {
        sizeSelection.style.display = 'none';
        sizeSelection.classList.add('d-none');
    }

    // --- Fallback price for products WITHOUT variations ---
    // Always reset the price text when no size variations exist
    if (!product.hasVariations) {
        detailPrice.textContent = product.price.startsWith('$')
            ? product.price
            : `$${product.price}`;
    }
}

    // --- GST Note ---
    if (modalGSTNote) {
        const hasGst = product.gst && product.gst.trim();
        modalGSTNote.style.display = hasGst ? 'block' : 'none';
        if (hasGst) {
            const smallTag = modalGSTNote.querySelector('small');
            if (smallTag) smallTag.textContent = product.gst;
        }
    }

    detailImage.onload = function() {
      detailImage.style.opacity = '1';
      detailImage.onload = null;
    };
}



  // Modal navigation
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + modalProducts.length) % modalProducts.length;
      updateModalContent(currentIndex);
    });
    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % modalProducts.length;
      updateModalContent(currentIndex);
    });

    document.getElementById('decrement')?.addEventListener('click', () => {
      if (quantity > 1) quantityDisplay.textContent = --quantity;
    });
    document.getElementById('increment')?.addEventListener('click', () => {
      quantityDisplay.textContent = ++quantity;
    });

    function openProductModal(productId) {
      modalProducts = getVisibleProducts();
      currentIndex = modalProducts.findIndex(p => p.id === productId);
      if (currentIndex < 0) return;
      updateModalContent(currentIndex);
      productDetailModal.show();
    }

    carouselItems.forEach(card => {
      const trigger = card.querySelector('.product-image-trigger');
      if (trigger) trigger.addEventListener('click', () => openProductModal(card.dataset.productId));
    });


  // Image loading optimization function
    function optimizeImageLoading() {
  // Add preload hint for visible images
      const visibleProducts = getVisibleProducts().slice(0, 8); // Preload first 8 visible products
      visibleProducts.forEach(product => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = product.image;
        link.as = 'image';
        document.head.appendChild(link);
      });
      
      // Add image loading observer
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.dataset.src;
            if (src) {
              // Apply loading animation
              img.classList.add('loading');
              
              // Set up load handler before setting src
              img.onload = function() {
                img.classList.remove('loading');
                img.classList.add('loaded');
                const placeholder = img.parentElement.querySelector('.image-placeholder');
                if (placeholder) placeholder.style.opacity = '0';
                observer.unobserve(img);
              };
              
              // Set the actual src to begin loading
              img.src = src;
              img.removeAttribute('data-src');
            }
          }
        });
      }, { threshold: 0.1, rootMargin: '200px' });
      
      // Apply to all image containers that might need lazy loading
      document.querySelectorAll('.grid-image-container').forEach(container => {
        const img = container.querySelector('img.grid-image');
        if (img && !img.src.includes('http')) {
          // Add placeholder and loading indicator if not already present
          if (!container.querySelector('.image-placeholder')) {
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerHTML = '<div class="loading-spinner"></div>';
            container.insertBefore(placeholder, img);
          }
          
          // Set up for lazy loading
          if (!img.classList.contains('loaded')) {
            if (img.dataset.src) {
              img.classList.add('loading');
              imageObserver.observe(img);
            }
          }
        }
      });
    }

  // Create product grid with lazy loading
  const productGrid = document.getElementById('productGrid');
  // Find the createGridView function and replace it with this improved version:
function createGridView(productsList) {
      productGrid.innerHTML = '';
      productsList.forEach(product => {
        const gridItem = document.createElement('div');
        gridItem.className = 'grid-item';
        Object.assign(gridItem.dataset, {
          productId: product.id,
          name: product.name,
          description: product.description,
          price: product.price,
          previousPrice: product.previousPrice,
          image: product.image,
          category: product.category,
          hasVariations: product.hasVariations,
          priceS: product.priceS,
          priceM: product.priceM,
          priceL: product.priceL,
          priceF: product.priceF,
          gst: product.gst,
          specialOffer: product.specialOffer,
          priceByPercentage: product.priceByPercentage
        });

        const isOnSale = product.status === 'Sale';
        const priceDisplay = product.priceByPercentage
          ? product.price
          : (product.price.startsWith('$') ? product.price : `$${product.price}`);

        gridItem.innerHTML = `
          <div class="grid-image-container">
            ${isOnSale ? '<span class="discount-badge">Sale</span>' : ''}
            <img
              src="${product.image}"
              alt="${product.name}"
              loading="lazy"
              class="grid-image" />
          </div>
          <div class="grid-details">
            <h3>${product.name}</h3>
            <div class="rating">
              <i class="fas fa-star"></i> <span>4.9</span> <span class="review-count">(203)</span>
            </div>
            <div class="price-row">
              <div class="price"><span>${priceDisplay}</span></div>
              <button class="add-to-cart" data-product-id="${product.id}" data-name="${product.name}" data-price="${product.price}" data-image="${product.image}">
                <i class="fas fa-shopping-cart"></i>
              </button>
            </div>
          </div>
        `;
        productGrid.appendChild(gridItem);
      });

      // Re‑attach modal trigger events
      document.querySelectorAll('.grid-item').forEach(item => {
        item.addEventListener('click', e => {
          if (!e.target.closest('.add-to-cart')) {
            openProductModal(item.dataset.productId);
          }
        });
      });
    }

    // Stub out the old optimization function
    function optimizeImageLoading() {
      // no-op: relying on native <img loading="lazy">
    }


  // View toggle logic
  const viewAllButton = document.querySelector('.view-all');
  const featuredSection = document.querySelector('.featured-section');
  const productGridContainer = document.getElementById('productGridContainer');

  function extractProductsFromCarousel() {
    return Array.from(document.querySelectorAll('.food-item')).map(item => ({
      id: item.dataset.productId,
      name: item.dataset.name,
      description: item.dataset.description || '',
      price: item.dataset.price,
      previousPrice: item.dataset.previousPrice || '169',
      image: item.dataset.image,
      status: item.querySelector('.discount-badge') ? 'Sale' : 'Regular',
      category: item.dataset.category || 'featured',
      hasVariations: item.dataset.hasVariations === "true",
      priceS: item.dataset.priceS || item.dataset.price,
      priceM: item.dataset.priceM || item.dataset.price,
      priceL: item.dataset.priceL || item.dataset.price,
      priceF: item.dataset.priceF || item.dataset.price,
      gst: item.dataset.gst || "",
      specialOffer: item.dataset.specialOffer || "",
      priceByPercentage: item.dataset.priceByPercentage === "true"
    }));
  }

  if (viewAllButton) {
  viewAllButton.addEventListener('click', () => {
    products = extractProductsFromCarousel();
    featuredSection.classList.add('fade-out');
    setTimeout(() => {
      featuredSection.style.display = 'none';
      productGridContainer.style.display = 'block';
      
      // Create the grid first
      createGridView(products);
      
      // Then filter by category
      filterItemsByCategory(lastSelectedCategory);
      
      // Apply fade-in effect
      productGridContainer.classList.add('fade-in');
      window.scrollTo(0, 0);
      
      setTimeout(() => {
        productGridContainer.classList.remove('fade-in');
        // No need to call optimizeImageLoading() here since createGridView already does it
      }, 300);
    }, 300);
  });
}

// Function to preload modal images
    function preloadModalImages() {
      if (!modalProducts || !modalProducts.length) return;
      
      modalProducts.forEach((product, index) => {
        // Preload the next 2 images to ensure smooth modal navigation
        if (index === currentIndex || 
            index === (currentIndex + 1) % modalProducts.length || 
            index === (currentIndex + 2) % modalProducts.length) {
          const img = new Image();
          img.src = product.image;
        }
      });
    }


  const backButton = document.querySelector('.back-to-carousel');
  if (backButton) {
    backButton.addEventListener('click', () => {
      productGridContainer.classList.add('fade-out');
      setTimeout(() => {
        productGridContainer.style.display = 'none';
        featuredSection.style.display = 'block';
        filterItemsByCategory(lastSelectedCategory);
        featuredSection.classList.add('fade-in');
        setTimeout(() => {
          featuredSection.classList.remove('fade-in', 'fade-out');
          productGridContainer.classList.remove('fade-out');
        }, 300);
      }, 300);
    });
  }

  // Category filter and search
  const categoryButtons = document.querySelectorAll('.category-btn');
  const searchInput = document.querySelector('.search-input');
  const searchDropdown = document.querySelector('.search-results-dropdown');
  const searchResultsContent = document.querySelector('.search-results-content');
  const featuredButton = document.querySelector('[data-category="featured"]');
  const isRestaurantId9 = !featuredButton;

  if (isRestaurantId9) {
    const activeButton = document.querySelector('.category-btn.active');
    if (activeButton) lastSelectedCategory = activeButton.dataset.category.toLowerCase();
  }

  function filterItemsByCategory(categoryName) {
    const activeItems = featuredSection && featuredSection.style.display !== 'none' ?
      document.querySelectorAll('.featured-section .food-item') : document.querySelectorAll('.grid-item');
    activeItems.forEach(item => {
      const itemCategory = (item.dataset.category || '').toLowerCase();
      item.style.display = isRestaurantId9 ? 
        (itemCategory === categoryName.toLowerCase() ? '' : 'none') :
        (categoryName === 'featured' || itemCategory === categoryName.toLowerCase() ? '' : 'none');
    });
  }

  function handleCategoryClick(button) {
    categoryButtons.forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    lastSelectedCategory = button.dataset.category.toLowerCase();
    filterItemsByCategory(lastSelectedCategory);
    button.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    if (searchDropdown) searchDropdown.style.display = 'none';
    updateFilterDropdownIndicator(lastSelectedCategory);
  }

  categoryButtons.forEach(button => button.addEventListener('click', () => handleCategoryClick(button)));

  function updateFilterDropdownIndicator(selectedCategory) {
    const dropdownItems = document.querySelectorAll('.filter-dropdown li');
    dropdownItems.forEach(li => {
      const categoryName = li.querySelector('.category-name')?.textContent.toLowerCase() || '';
      const existingIndicator = li.querySelector('.active-indicator');
      if (existingIndicator) existingIndicator.remove();
      li.style.backgroundColor = li.style.fontWeight = li.style.color = '';
      if (categoryName === selectedCategory) {
        const activeIndicator = document.createElement('span');
        activeIndicator.className = 'active-indicator';
        activeIndicator.innerHTML = '<i class="fas fa-check"></i>';
        activeIndicator.style.cssText = 'margin-left: auto; color: #4682B4; font-size: 12px;';
        li.appendChild(activeIndicator);
        li.style.backgroundColor = 'rgba(70, 130, 255, 0.08)';
        li.style.fontWeight = '500';
        li.style.color = '#4682B4';
        li.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
      li.addEventListener('mouseover', () => {
        li.style.backgroundColor = categoryName === selectedCategory ? 'rgba(70, 130, 255, 0.12)' : 'rgba(0, 0, 0, 0.03)';
      });
      li.addEventListener('mouseout', () => {
        li.style.backgroundColor = categoryName === selectedCategory ? 'rgba(70, 130, 255, 0.08)' : '';
      });
    });
  }

  // Filter dropdown
  const filterButton = document.querySelector('.filter-button');
  if (filterButton) {
    Object.assign(filterButton.style, {
      display: 'flex', alignItems: 'center', justifyContent: 'center', width: '36px', height: '36px',
      borderRadius: '50%', backgroundColor: 'rgba(255, 255, 255, 0.15)', backdropFilter: 'blur(4px)',
      transition: 'all 0.2s ease', border: 'none', cursor: 'pointer'
    });
    filterButton.addEventListener('mousedown', () => filterButton.style.transform = 'scale(0.95)');
    filterButton.addEventListener('mouseup', () => filterButton.style.transform = '');
    const filterIcon = filterButton.querySelector('i');
    if (filterIcon) filterIcon.style.cssText = 'font-size: 16px; color: #fff;';
  }

  const filterDropdown = document.createElement('div');
  filterDropdown.className = 'filter-dropdown';
  Object.assign(filterDropdown.style, {
    display: 'none', position: 'fixed', backgroundColor: 'rgb(255, 255, 255)',
    border: '1px solid rgba(255, 255, 255, 0.18)', boxShadow: '0 10px 25px rgba(0, 0, 0, 0.12)',
    borderRadius: '16px', padding: '8px 0', zIndex: '9999', width: '200px', maxHeight: '70vh',
    overflowY: 'auto', backdropFilter: 'blur(10px)', transformOrigin: 'top center'
  });

  const filterList = document.createElement('ul');
  filterList.style.cssText = 'list-style: none; margin: 0; padding: 0;';

  const filterHeading = document.createElement('div');
  filterHeading.textContent = 'Filter by Category';
  filterHeading.style.cssText = 'padding: 12px 16px; font-weight: 600; font-size: 15px; border-bottom: 1px solid rgba(0, 0, 0, 0.05); margin-bottom: 6px; color: #333; display: flex; align-items: center;';
  const filterIconSpan = document.createElement('span');
  filterIconSpan.innerHTML = '<i class="fas fa-sliders-h"></i>';
  filterIconSpan.style.cssText = 'margin-right: 8px; color: #4682B4; font-size: 14px;';
  filterHeading.prepend(filterIconSpan);
  filterDropdown.appendChild(filterHeading);

  categoryButtons.forEach(button => {
    const li = document.createElement('li');
    const categoryName = button.dataset.category;
    const categoryEmoji = button.querySelector('.category-icon')?.textContent.trim() || '';
    const isActive = categoryName.toLowerCase() === lastSelectedCategory;
    li.innerHTML = `
      <span class="category-emoji">${categoryEmoji}</span>
      <span class="category-name">${categoryName}</span>
      ${isActive ? '<span class="active-indicator"><i class="fas fa-check"></i></span>' : ''}
    `;
    li.style.cssText = `
      padding: 12px 16px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 10px;
      position: relative; margin: 2px 6px; border-radius: 8px;
      ${isActive ? 'background-color: rgba(70, 130, 255, 0.08); font-weight: 500; color: #4682B4;' : ''}
    `;

    li.addEventListener('click', () => {
      const targetButton = Array.from(categoryButtons).find(btn => btn.dataset.category === categoryName);
      if (targetButton) handleCategoryClick(targetButton);
      filterDropdown.style.display = 'none';
      filterButton.classList.remove('active');
      const ripple = document.createElement('span');
      ripple.style.cssText = `
        position: absolute; top: 50%; left: 50%; width: 5px; height: 5px; background: rgba(70, 130, 255, 0.3);
        opacity: 0; border-radius: 100%; transform: scale(1, 1) translate(-50%, -50%); animation: ripple 0.6s ease-out;
      `;
      li.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    });

    filterList.appendChild(li);
  });
  filterDropdown.appendChild(filterList);
  document.body.appendChild(filterDropdown);

  const rippleStyle = document.createElement('style');
  rippleStyle.id = 'ripple-animation';
  rippleStyle.textContent = '@keyframes ripple { 0% { transform: scale(0, 0); opacity: 0.5; } 100% { transform: scale(40, 40); opacity: 0; } }';
  document.head.appendChild(rippleStyle);

  function positionDropdown() {
    if (!filterButton) return;
    const rect = filterButton.getBoundingClientRect();
    filterDropdown.style.top = `${rect.bottom + window.scrollY + 10}px`;
    filterDropdown.style.left = Math.min(rect.left + window.scrollX - 5, window.innerWidth - 205 + window.scrollX) + 'px';
  }

  if (filterButton) {
    filterButton.addEventListener('click', e => {
      e.stopPropagation();
      if (filterDropdown.style.display !== 'block') {
        positionDropdown();
        filterDropdown.style.display = 'block';
        filterDropdown.style.opacity = '0';
        filterDropdown.style.transform = 'translateY(-10px) scale(0.98)';
        setTimeout(() => {
          filterDropdown.style.transition = 'opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1), transform 0.25s cubic-bezier(0.4, 0, 0.2, 1)';
          filterDropdown.style.opacity = '1';
          filterDropdown.style.transform = 'translateY(0) scale(1)';
        }, 10);
        filterButton.classList.add('active');
      } else {
        filterDropdown.style.opacity = '0';
        filterDropdown.style.transform = 'translateY(-10px) scale(0.98)';
        setTimeout(() => filterDropdown.style.display = 'none', 250);
        filterButton.classList.remove('active');
      }
    });
  }

  window.addEventListener('resize', () => {
    if (filterDropdown.style.display === 'block') positionDropdown();
  });

  document.addEventListener('click', e => {
    if (filterButton && !filterButton.contains(e.target) && !filterDropdown.contains(e.target)) {
      filterDropdown.style.display = 'none';
      filterButton.classList.remove('active');
    }
  });

  // Search functionality
  function createSearchResultItem(item) {
    const div = document.createElement('div');
    div.className = 'search-result-item';
    div.innerHTML = `
      <img src="${item.dataset.image}" alt="${item.dataset.name}" class="search-result-image">
      <div class="search-result-info">
        <div class="search-result-name">${item.dataset.name}</div>
        <div class="search-result-category">${item.dataset.category}</div>
      </div>
    `;
    div.addEventListener('click', () => {
      const searchCategory = item.dataset.category.toLowerCase();
      if (searchCategory !== lastSelectedCategory) {
        const targetButton = Array.from(categoryButtons).find(btn => btn.dataset.category.toLowerCase() === searchCategory);
        if (targetButton) handleCategoryClick(targetButton);
      }
      setTimeout(() => {
        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
        item.style.transition = 'transform 0.3s ease';
        item.style.transform = 'scale(1.02)';
        setTimeout(() => item.style.transform = '', 300);
      }, 100);
      if (searchDropdown) searchDropdown.style.display = 'none';
      if (searchInput) searchInput.value = '';
    });
    return div;
  }

  if (searchInput && searchDropdown && searchResultsContent) {
    searchInput.addEventListener('input', e => {
      const searchTerm = e.target.value.toLowerCase().trim();
      if (!searchTerm) {
        searchDropdown.style.display = 'none';
        filterItemsByCategory(lastSelectedCategory);
        return;
      }

      searchResultsContent.innerHTML = '';
      let matches = 0;
      const activeItems = featuredSection && featuredSection.style.display !== 'none' ?
        document.querySelectorAll('.featured-section .food-item') : document.querySelectorAll('.grid-item');
      activeItems.forEach(item => {
        const name = (item.dataset.name || '').toLowerCase();
        const itemCategory = (item.dataset.category || '').toLowerCase();
        if (name.includes(searchTerm) || itemCategory.includes(searchTerm)) {
          matches++;
          searchResultsContent.appendChild(createSearchResultItem(item));
        }
      });

      searchDropdown.style.display = matches ? 'block' : 'block';
      if (!matches) searchResultsContent.innerHTML = `<div class="no-results-message">No results found for "${searchTerm}"</div>`;
    });

    document.addEventListener('click', e => {
      if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) searchDropdown.style.display = 'none';
    });
  }

  // Initialization
  if (!isRestaurantId9 && featuredButton) {
    categoryButtons.forEach(btn => btn.classList.remove('active'));
    featuredButton.classList.add('active');
    lastSelectedCategory = 'featured';
  } else if (isRestaurantId9) {
    const activeButton = document.querySelector('.category-btn.active');
    if (activeButton) {
      lastSelectedCategory = activeButton.dataset.category.toLowerCase();
      filterItemsByCategory(lastSelectedCategory);
      setTimeout(() => activeButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }), 100);
    }
  }

  setTimeout(() => updateFilterDropdownIndicator(lastSelectedCategory), 200);

  // Add-to-cart handler
  productGrid.addEventListener('click', e => {
    const button = e.target.closest('.add-to-cart');
    if (button) {
      const { productId, name, price } = button.dataset;
      if (typeof addToCart === 'function') {
        addToCart(productId, name, price);
      } else {
        console.log('Adding to cart:', name);
        button.classList.add('added');
        setTimeout(() => button.classList.remove('added'), 300);
      }
    }
  });
});
</script>







<script>
function closeNotification() {
  document.getElementById('notification-banner').style.display = 'none';
  
  // Set a cookie to remember the user closed this notification
  document.cookie = "notification_{{ notification.id }}_closed=true; path=/; max-age=86400";
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cartButton = document.querySelector('.floating-cart-button');
  
  // Improved cart page detection
  const isCartPage = 
    window.location.pathname.includes('/cart') || 
    window.location.pathname.includes('/checkout') || 
    document.querySelector('.cart-page') !== null ||
    document.querySelector('#offcanvasRight.show') !== null;
  
  // If we're on the cart page or the cart is showing, hide the button and don't initialize
  if (isCartPage) {
    if (cartButton) {
      cartButton.style.display = 'none';
    }
    return;
  }
  
  // Make sure the button is visible if we're not on a cart page
  if (cartButton) {
    cartButton.style.display = '';
  } else {
    // If button doesn't exist (unlikely given your setup), we can't proceed
    console.error("Floating cart button not found");
    return;
  }

  const cartIcon = cartButton.querySelector('i');
  let isDragging = false;
  let isClick = false;
  let offsetX, offsetY;
  let startTime;

  // Show the "Drag me" tooltip on page load
  cartButton.classList.add('show-tooltip');
  setTimeout(() => {
    cartButton.classList.remove('show-tooltip');
  }, 3000);

  // Add a real click listener for non-drag clicks
  cartButton.addEventListener('click', () => {
    openCartModal();
  });

  // Restore saved position
  const savedPosition = localStorage.getItem('cartButtonPosition');
  if (savedPosition) {
    try {
      const position = JSON.parse(savedPosition);
      cartButton.style.left = position.left;
      cartButton.style.top = position.top;
      cartButton.style.bottom = 'auto';
      cartButton.style.right = 'auto';
    } catch (e) {
      // Handle corrupted localStorage
      console.error("Error restoring cart button position:", e);
      localStorage.removeItem('cartButtonPosition');
    }
  }

  // Start drag on mouse or touch
  cartButton.addEventListener('mousedown', startDrag);
  cartButton.addEventListener('touchstart', startDrag);

  // Continue drag
  document.addEventListener('mousemove', drag);
  document.addEventListener('touchmove', drag, { passive: false });

  // End drag
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchend', endDrag);

  function startDrag(e) {
    startTime = Date.now();
    isClick = true;
    isDragging = true;

    const rect = cartButton.getBoundingClientRect();
    if (e.type === 'mousedown') {
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      e.preventDefault(); // only block default on mouse to avoid text-selection
    } else {
      // touchstart: don't preventDefault so that click will still fire
      offsetX = e.touches[0].clientX - rect.left;
      offsetY = e.touches[0].clientY - rect.top;
    }

    cartButton.style.transition = 'none';
    cartButton.classList.add('dragging');
    cartIcon.classList.add('cart-spinning');
  }

  function drag(e) {
    if (!isDragging) return;
    isClick = false; // any movement → not a click

    let clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
    let clientY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
    e.preventDefault(); // block page scroll during drag

    let newX = clientX - offsetX;
    let newY = clientY - offsetY;

    // clamp to viewport
    const bw = cartButton.offsetWidth, bh = cartButton.offsetHeight;
    const ww = window.innerWidth, wh = window.innerHeight;
    newX = Math.min(Math.max(newX, 10), ww - bw - 10);
    newY = Math.min(Math.max(newY, 10), wh - bh - 10);

    cartButton.style.left = newX + 'px';
    cartButton.style.top = newY + 'px';
    cartButton.style.right = 'auto';
    cartButton.style.bottom = 'auto';
  }

  function endDrag() {
    if (!isDragging) return;
    const timeDiff = Date.now() - startTime;
    isDragging = false;

    cartButton.style.transition = 'all 0.3s ease';
    cartButton.classList.remove('dragging');
    cartIcon.classList.remove('cart-spinning');
    cartIcon.classList.add('cart-stop');
    setTimeout(() => cartIcon.classList.remove('cart-stop'), 600);

    // Persist position
    localStorage.setItem('cartButtonPosition', JSON.stringify({
      left: cartButton.style.left,
      top: cartButton.style.top
    }));

    // If it was a quick tap (<200ms), fire the click logic:
    if (isClick && timeDiff < 200) {
      openCartModal();
    }
  }

  // Keep it on-screen after a resize
  window.addEventListener('resize', function() {
    const rect = cartButton.getBoundingClientRect();
    const ww = window.innerWidth, wh = window.innerHeight;
    let x = Math.min(Math.max(rect.left, 10), ww - rect.width - 10);
    let y = Math.min(Math.max(rect.top, 10), wh - rect.height - 10);
    cartButton.style.left = x + 'px';
    cartButton.style.top = y + 'px';
    localStorage.setItem('cartButtonPosition', JSON.stringify({
      left: cartButton.style.left,
      top: cartButton.style.top
    }));
  });

  // Demo API for bouncing the count
  window.updateCartCount = function(count) {
    const cartCount = document.querySelector('.cart-count');
    cartCount.textContent = count + (count === 1 ? ' Item' : ' Items');
    cartButton.classList.add('cart-bounce');
    setTimeout(() => cartButton.classList.remove('cart-bounce'), 300);
  };

  // YOUR cart-opening logic here:
  function openCartModal() {
    // This already exists in your HTML as a data-bs-target attribute
    const offcanvasTarget = cartButton.getAttribute('data-bs-target');
    if (offcanvasTarget) {
      const offcanvasElement = document.querySelector(offcanvasTarget);
      if (offcanvasElement) {
        // Use Bootstrap's offcanvas API if available
        if (window.bootstrap && bootstrap.Offcanvas) {
          const offcanvasInstance = new bootstrap.Offcanvas(offcanvasElement);
          offcanvasInstance.show();
        } else {
          // Fallback if Bootstrap JS isn't loaded
          offcanvasElement.classList.add('show');
        }
      }
    }
    console.log('Opening cart…');
  }
  
  // Add listener to hide button when the offcanvas is opened
  const offcanvasRight = document.querySelector('#offcanvasRight');
  if (offcanvasRight) {
    offcanvasRight.addEventListener('show.bs.offcanvas', function() {
      cartButton.style.display = 'none';
    });
    
    offcanvasRight.addEventListener('hidden.bs.offcanvas', function() {
      // Only show the button again if we're not on a cart page
      if (!window.location.pathname.includes('/cart') && 
          !window.location.pathname.includes('/checkout')) {
        cartButton.style.display = '';
      }
    });
  }
});
</script>

<script>
  document.querySelectorAll('.product-image-trigger').forEach(img => {
    if (img.complete) {
      img.classList.add('loaded');
    } else {
      img.addEventListener('load', () => img.classList.add('loaded'));
    }
  });
</script>


<!-- <script>
document.addEventListener('DOMContentLoaded', () => {
  // --- CoachMarkTour Class Definition ---
  class CoachMarkTour {
    constructor(steps, options = {}) {
      this.steps = steps;
      this.options = {
        initialDelay: 500, // Delay before starting
        zIndexBase: 2000,
        messageSpacing: 10, // Reduced spacing between target and message/arrow
        maxWidth: 210, // Smaller max-width for coach marks
        // --- OPTIONS ---
        persistenceKey: null, // e.g., 'menuTourCompletedV1'. If set, uses localStorage to track completion.
        onShowStep: null, // Callback function(step, targetElement) when a step is shown
        onEndTour: null, // Callback function(status) when the tour ends ('completed', 'skipped')
        // --- END OPTIONS ---
        ...options,
      };
      this.currentIndex = 0;
      this.container = null;
      this.spotlight = null;
      this.circle = null;
      this.arrowEl = null;
      this.currentMark = null;
      this.currentOverlay = null;
      this.tourStarted = false;
      this.currentStep = null;
      this.currentTargetRect = null;
      this._carouselElement = null;
      this._carouselScrollListener = null;
      this._resizeDebounceTimer = null;
      this._dontShowAgainCheckbox = null; // To hold the checkbox element
      this._endTourTimeout = null; // Timeout handle for resize issues

      // Bind methods
      this._showNext = this._showNext.bind(this);
      this.endTour = this.endTour.bind(this);
      this._handleResize = this._handleResize.bind(this);
      this._debouncedResize = this._debouncedResize.bind(this);
      this._handleKeydown = this._handleKeydown.bind(this);
      this._markTourCompleted = this._markTourCompleted.bind(this);

      this._injectStyles();
    }

    _injectStyles() {
      const styleId = 'coach-mark-styles';
      if (document.getElementById(styleId)) return;

      const styleEl = document.createElement('style');
      styleEl.id = styleId;
      // --- CSS STYLES ---
      styleEl.textContent = `
        .coach-mark-container {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          z-index: ${this.options.zIndexBase};
          pointer-events: none;
          background: transparent;
          transition: background 0.3s ease-in-out, opacity 0.3s ease-in-out; /* Added opacity */
        }
        .coach-mark-container.active {
          background: rgba(0, 0, 0, 0.5);
        }
        .coach-mark, .coach-mark-intro {
          position: absolute; background: #333;
          color: #fff; padding: 8px 12px; border-radius: 8px;
          max-width: ${this.options.maxWidth}px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
          z-index: ${this.options.zIndexBase + 2};
          pointer-events: auto; text-align: center;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          opacity: 0; transform: scale(0.95);
          transition: opacity 0.3s ease, transform 0.3s ease;
          font-size: 14px;
        }
        .coach-mark-intro {
          position: fixed; top: 50%; left: 50%;
          transform: translate(-50%, -50%) scale(0.95);
          padding: 12px 16px;
          width: calc(100% - 40px);
          max-width: 280px; /* Slightly larger intro */
        }
        .coach-mark.visible, .coach-mark-intro.visible {
          opacity: 1; transform: scale(1);
        }
        .coach-mark-intro.positioning { transform: translate(-50%, -50%) scale(1); }
        .coach-mark-intro-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .coach-mark-intro-content { font-size: 13px; margin-bottom: 14px; line-height: 1.3; }
        .coach-mark-content { font-size: 13px; font-weight: 400; margin-bottom: 12px; line-height: 1.3; }
        .coach-mark-buttons {
          display: flex; justify-content: space-between; align-items: center; gap: 8px;
          margin-top: 8px; /* Added margin top for spacing */
        }
        .coach-mark-button {
          background: #007aff; color: #fff; border: none;
          border-radius: 4px; padding: 6px 12px; font-size: 13px; font-weight: 500;
          cursor: pointer; flex-grow: 1;
          transition: background-color 0.2s ease;
        }
        .coach-mark-button:hover { background-color: #005ecb; }
        .coach-mark-skip {
          background: transparent; color: rgba(255,255,255,0.8); border: 1px solid rgba(255,255,255,0.5);
          border-radius: 4px; padding: 5px 10px; font-size: 12px; font-weight: 400; cursor: pointer;
          transition: background-color 0.2s ease, color 0.2s ease;
        }
        .coach-mark-skip:hover { background-color: rgba(255,255,255,0.1); color: #fff; }
        .highlight-spotlight {
          position: absolute; border-radius: 4px;
          box-shadow: 0 0 0 9999px rgba(0,0,0,0.5);
          pointer-events: none; z-index: ${this.options.zIndexBase - 1};
          transition: top 0.3s ease, left 0.3s ease, width 0.3s ease, height 0.3s ease, border-radius 0.3s ease;
        }
        .highlight-circle {
          position: absolute; border: 2px dashed #fff;
          border-radius: 4px; pointer-events: none; z-index: ${this.options.zIndexBase - 1};
          animation: pulse 1.8s infinite ease-in-out;
          transition: top 0.3s ease, left 0.3s ease, width 0.3s ease, height 0.3s ease, border-radius 0.3s ease, opacity 0.3s ease;
          opacity: 0; /* Start hidden */
        }
        .highlight-circle.visible { opacity: 1; } /* Fade in */
        .coach-mark-arrow {
          position: absolute; top: 0; left: 0; width: 100%; height: 100%;
          z-index: ${this.options.zIndexBase + 1};
          pointer-events: none;
          opacity: 0;
          transition: opacity 0.3s ease 0.1s;
        }
        .coach-mark-arrow.visible { opacity: 1; }
        .coach-mark-arrow path { stroke-dashoffset: 1000; animation: draw 1s ease forwards 0.2s; }
        @keyframes pulse {
          0% { opacity:0.5; transform: scale(1); }
          50% { opacity:1; transform: scale(1.03); }
          100% { opacity:0.5; transform: scale(1); }
        }
        @keyframes draw { to { stroke-dashoffset: 0; } }
        @media (max-width:480px){
          .coach-mark-intro { max-width: 85vw; padding: 10px 14px; }
          .coach-mark { max-width: 200px; padding: 8px 10px; }
          .coach-mark-intro-title { font-size: 15px; margin-bottom: 6px; }
          .coach-mark-content, .coach-mark-intro-content { font-size: 12px; margin-bottom: 10px; }
          .coach-mark-button { padding: 6px 10px; font-size: 12px; }
          .coach-mark-skip { padding: 5px 8px; font-size: 11px; }
        }
        .prevent-click-overlay {
          position: absolute; background: transparent;
          z-index: ${this.options.zIndexBase + 1};
        }
        .coach-mark-persistence {
          margin-top: 12px;
          padding-top: 10px;
          border-top: 1px solid rgba(255, 255, 255, 0.2);
          text-align: left;
          display: flex;
          align-items: center;
        }
        .coach-mark-persistence input[type="checkbox"] {
          margin-right: 8px;
          appearance: none;
          background-color: rgba(255, 255, 255, 0.2);
          width: 14px;
          height: 14px;
          border: 1px solid rgba(255, 255, 255, 0.5);
          border-radius: 3px;
          display: inline-block;
          position: relative;
          cursor: pointer;
          flex-shrink: 0;
          vertical-align: middle; /* Align better with label */
        }
        .coach-mark-persistence input[type="checkbox"]:checked {
          background-color: #007aff;
          border-color: #007aff;
        }
        .coach-mark-persistence input[type="checkbox"]:checked::after {
            content: '✓';
            font-size: 10px;
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            line-height: 1;
        }
        .coach-mark-persistence label {
          font-size: 11px;
          color: rgba(255, 255, 255, 0.8);
          cursor: pointer;
          line-height: 1.2;
          flex-grow: 1; /* Take remaining space */
          vertical-align: middle; /* Align better with checkbox */
        }
      `;
      // --- END CSS STYLES ---
      document.head.appendChild(styleEl);
    }

    _createContainer() {
      if (this.container) this.container.remove();
      this.container = document.createElement('div');
      this.container.className = 'coach-mark-container';
      this.container.setAttribute('role', 'dialog');
      this.container.setAttribute('aria-modal', 'true');
      this.container.style.opacity = '0'; // Start hidden for fade-in

      this.spotlight = document.createElement('div');
      this.spotlight.className = 'highlight-spotlight';
      this.circle = document.createElement('div');
      this.circle.className = 'highlight-circle';
      this.arrowEl = document.createElement('div');
      this.arrowEl.className = 'coach-mark-arrow';
      this.container.append(this.spotlight, this.circle, this.arrowEl);
      document.body.appendChild(this.container);
    }

    start(force = false) {
        if (!force && this.options.persistenceKey && localStorage.getItem(this.options.persistenceKey)) {
            console.log('CoachMarkTour: Tour already completed or skipped. Not starting.');
            return; // Don't start if already marked as completed/skipped
        }

        // Reset internal state in case start is called again (e.g., after reset)
        this.currentIndex = 0;
        this.tourStarted = false;
        this.currentStep = null;
        if (this.container) this.container.remove(); // Ensure no old container exists

        setTimeout(() => {
            this._showIntro();
            window.addEventListener('resize', this._debouncedResize);
            document.addEventListener('keydown', this._handleKeydown);
        }, this.options.initialDelay);
    }

    // Method to reset persistence state, can be called programmatically if needed
    resetTourState() {
      if (this.options.persistenceKey) {
          localStorage.removeItem(this.options.persistenceKey);
          console.log('CoachMarkTour: Persistence state reset.');
      }
    }

    _debouncedResize() {
      clearTimeout(this._resizeDebounceTimer);
      this._resizeDebounceTimer = setTimeout(this._handleResize, 150); // Slightly longer debounce
    }

    endTour(status = 'skipped') { // status can be 'skipped' or 'completed'
        if (!this.container && !this.tourStarted) return; // Avoid double-ending

        this.tourStarted = false; // Mark as not running first
        if (this._carouselElement && this._carouselScrollListener) {
            this._carouselElement.removeEventListener('scroll', this._carouselScrollListener);
            this._carouselElement = null;
            this._carouselScrollListener = null;
        }
        if (this._endTourTimeout) clearTimeout(this._endTourTimeout); // Clear resize timeout

        // Mark as completed/skipped *before* fading out if persistence is enabled
        if (this.options.persistenceKey) {
             const dontShowAgain = this.currentMark?.classList.contains('coach-mark-intro') && this._dontShowAgainCheckbox?.checked;
            this._markTourCompleted(status === 'completed' || dontShowAgain);
        }

        if (this.container) {
            this.container.style.opacity = '0'; // Fade out container
            // Use transitionend for cleaner removal after fade-out
            this.container.addEventListener('transitionend', (event) => {
                // Ensure it's the opacity transition ending on the container itself
                if (event.target === this.container && event.propertyName === 'opacity') {
                    if (this.container) this.container.remove();
                    this.container = null; // Nullify after removal
                }
            }, { once: true });
            // Fallback timeout in case transitionend doesn't fire (e.g., element removed early)
            setTimeout(() => {
                 if (this.container) this.container.remove();
                 this.container = null;
            }, 400);
        } else {
             this._cleanupCurrentStep(); // Still cleanup step elements if container somehow gone
        }


        window.removeEventListener('resize', this._debouncedResize);
        document.removeEventListener('keydown', this._handleKeydown);

        // Call the onEndTour callback
        if (typeof this.options.onEndTour === 'function') {
            try {
                this.options.onEndTour(status);
            } catch (e) {
                console.error("Error in onEndTour callback:", e);
            }
        }
        console.log(`CoachMarkTour: Tour ended with status: ${status}`);
        // Ensure cleanup runs even if container removal is delayed by transition
        this._cleanupCurrentStep();
    }

    _markTourCompleted(completed = true) {
        if (this.options.persistenceKey && completed) {
            try {
                 localStorage.setItem(this.options.persistenceKey, 'true');
                 console.log('CoachMarkTour: Marked as completed in localStorage.');
            } catch (e) {
                 console.error('CoachMarkTour: Failed to set persistence key in localStorage.', e);
            }
        }
    }

    _showIntro() {
      this._createContainer();
      requestAnimationFrame(() => { // Ensure container is in DOM before adding class
          if(this.container) this.container.style.opacity = '1'; // Fade in container for intro
      });

      const introId = 'coach-mark-intro-title';
      const contentId = 'coach-mark-intro-content';
      const checkboxId = 'coach-mark-dont-show-again';

      const intro = document.createElement('div');
      intro.className = 'coach-mark-intro';
      intro.setAttribute('role', 'document'); // More appropriate role? or keep dialog?
      intro.setAttribute('aria-labelledby', introId);
      intro.setAttribute('aria-describedby', contentId);

      const persistenceHtml = this.options.persistenceKey ? `
        <div class="coach-mark-persistence">
          <input type="checkbox" id="${checkboxId}" class="coach-mark-dont-show-checkbox">
          <label for="${checkboxId}">Don't show this tour again</label>
        </div>` : '';

      intro.innerHTML = `
        <div class="coach-mark-intro-title" id="${introId}">Welcome! Quick Tour?</div>
        <div class="coach-mark-intro-content" id="${contentId}">Let us show you around the main features.</div>
        ${persistenceHtml}
        <div class="coach-mark-buttons">
          <button class="coach-mark-skip">Skip</button>
          <button class="coach-mark-button">Start Tour</button>
        </div>`;

      this.container.appendChild(intro);
      this.currentMark = intro;

      if (this.options.persistenceKey) {
          this._dontShowAgainCheckbox = intro.querySelector(`#${checkboxId}`);
      }

      requestAnimationFrame(() => {
        intro.classList.add('visible', 'positioning');
        // Focus the start button for accessibility
        intro.querySelector('.coach-mark-button')?.focus();
      });

      intro.querySelector('.coach-mark-button').onclick = () => {
        // Don't remove intro immediately, fade out? For now, keep as is.
        this.currentMark = null; // Clear ref before potential removal in cleanup
        intro.remove();
        this.tourStarted = true;
        this._showNext(); // Start the actual tour steps
      };

      intro.querySelector('.coach-mark-skip').onclick = () => this.endTour('skipped');
    }

    _cleanupCurrentStep() {
      if (this.currentMark) {
        this.currentMark.remove();
        this.currentMark = null;
      }
      if (this.currentOverlay) {
        this.currentOverlay.remove();
        this.currentOverlay = null;
      }
      if (this.arrowEl) {
        this.arrowEl.innerHTML = ''; // Clear SVG
        this.arrowEl.classList.remove('visible');
      }
      if (this.circle) { // Hide circle between steps
          this.circle.classList.remove('visible');
      }
      // Don't remove the main container here, only the step-specific elements
      if (this._carouselElement && this._carouselScrollListener) {
        this._carouselElement.removeEventListener('scroll', this._carouselScrollListener);
        this._carouselElement = null;
        this._carouselScrollListener = null;
      }
       this._dontShowAgainCheckbox = null; // Clear checkbox ref
    }

    _showNext() {
        this._cleanupCurrentStep(); // Clean up previous step elements first

        if (!this.tourStarted) return; // Exit if tour was ended during cleanup/async ops

        if (this.currentIndex >= this.steps.length) {
            return this.endTour('completed'); // All steps done
        }
        this.currentStep = this.steps[this.currentIndex];
        let targetElement;

        try {
            if (typeof this.currentStep.target === 'function') {
                targetElement = this.currentStep.target();
            } else {
                targetElement = document.querySelector(this.currentStep.target);
            }
        } catch (e) {
             console.error("Error finding target:", this.currentStep.target, e);
             targetElement = null;
        }


        if (!targetElement || !this._isElementVisible(targetElement)) {
            console.warn(`Target not found or not visible: ${typeof this.currentStep.target === 'string' ? this.currentStep.target : '[Function]'}. Skipping.`);
            this.currentIndex++;
            requestAnimationFrame(this._showNext); // Use rAF for smoother skips
            return;
        }

        // Ensure container exists and activate background dimming
        if (!this.container || !document.body.contains(this.container)) {
            console.warn("Container missing, recreating.");
            this._createContainer(); // Should ideally not happen if tour started correctly
             requestAnimationFrame(() => { // Fade in recreated container
                 if(this.container) this.container.style.opacity = '1';
             });
        }
        this.container.classList.add('active'); // Dim background for steps

        this.currentTargetRect = targetElement.getBoundingClientRect();

        // --- Scroll into view logic ---
        const needsScroll = !this.currentStep.carouselItem &&
                           (this.currentTargetRect.top < 80 || this.currentTargetRect.bottom > window.innerHeight - 80);

        if (needsScroll) {
            const scrollOptions = { behavior: 'smooth', block: 'center' };
            // Adjust block based on element size relative to viewport
            if (this.currentTargetRect.height > window.innerHeight * 0.6) {
                 scrollOptions.block = this.currentTargetRect.top < 80 ? 'start' : 'end';
            } else {
                 scrollOptions.block = 'center'; // Default center for smaller elements
            }

            // Check if already scrolling (basic prevention)
            if (this.container.dataset.isScrolling === 'true') {
                 console.log("Already scrolling, delaying step show.");
                 setTimeout(() => this._showNext(), 100); // Retry shortly
                 return;
            }
            this.container.dataset.isScrolling = 'true';

            targetElement.scrollIntoView(scrollOptions);

            // Use a promise-based approach or reliable event detection for scroll end if possible
            // Simple timeout fallback:
            setTimeout(() => {
                if (!this.tourStarted) return; // Check if tour ended during scroll
                this.container.dataset.isScrolling = 'false'; // Reset scroll flag

                // Re-select and re-check visibility after scroll
                let scrolledTarget;
                 try {
                    scrolledTarget = typeof this.currentStep.target === 'function' ? this.currentStep.target() : document.querySelector(this.currentStep.target);
                 } catch(e) { scrolledTarget = null; }

                if (!scrolledTarget || !this._isElementVisible(scrolledTarget)) {
                    console.warn("Target became invisible after scroll. Skipping step.");
                    this.currentIndex++;
                    requestAnimationFrame(this._showNext);
                    return;
                }
                this.currentTargetRect = scrolledTarget.getBoundingClientRect();
                this._positionHighlight(this.currentTargetRect);
                this._positionAndShowMark(scrolledTarget); // Pass the potentially re-queried element
            }, 400); // Adjust delay: longer might be safer but feels slower

        } else {
            // Position highlight immediately if no scroll needed or for carousel
            this._positionHighlight(this.currentTargetRect);
            this._positionAndShowMark(targetElement);
        }
    }

    // Helper function to position and display the mark, overlay, and arrow
    _positionAndShowMark(targetElement) {
        if (!this.tourStarted || !this.container) return; // Ensure tour is active

        // Handle carousel listener setup
        if (this.currentStep.carouselItem) {
            if (this._carouselElement && this._carouselScrollListener) { // Clean up previous if any
                 this._carouselElement.removeEventListener('scroll', this._carouselScrollListener);
            }
             this._carouselElement = targetElement.closest('.items-carousel') || targetElement; // Listen on carousel container if possible
             this._carouselScrollListener = () => {
                if (!this.tourStarted || !document.body.contains(targetElement)){ return; } // Check tour and element state
                this.currentTargetRect = targetElement.getBoundingClientRect();
                this._positionHighlight(this.currentTargetRect); // Reposition highlight
                this._positionMark(this.currentMark, this.currentTargetRect, this.currentStep); // Reposition mark
                if (this.currentOverlay) this._positionOverlay(this.currentTargetRect); // Reposition overlay
                if (this.currentStep.showArrow) {
                    this._positionArrow(this.currentMark, this.currentTargetRect); // Reposition arrow
                }
             };
             this._carouselElement.addEventListener('scroll', this._carouselScrollListener, { passive: true });

            // Add overlay to block clicks for carousel items
            this.currentOverlay = document.createElement('div');
            this.currentOverlay.className = 'prevent-click-overlay';
            this._positionOverlay(this.currentTargetRect); // Position it initially
            this.container.appendChild(this.currentOverlay);
            this.currentOverlay.addEventListener('click', e => { // Prevent clicks passing through
                e.stopPropagation();
                e.preventDefault();
            });
        }

        // Create the coach mark popup
        const isFinalStep = this.currentIndex === this.steps.length - 1;
        const nextButtonText = isFinalStep ? 'Done' : 'Next';
        const markId = `coach-mark-content-${this.currentIndex}`;
        const mark = document.createElement('div');
        mark.className = 'coach-mark';
        mark.setAttribute('role', 'tooltip');
        mark.setAttribute('aria-describedby', markId);
        // Sanitize step text? For now, assume safe.
        mark.innerHTML = `
          <div class="coach-mark-content" id="${markId}">${this.currentStep.text}</div>
          <div class="coach-mark-buttons">
            <button class="coach-mark-skip">Skip</button>
            <button class="coach-mark-button">${nextButtonText}</button>
          </div>`;
        this.container.appendChild(mark);
        this.currentMark = mark; // Assign to instance property

        // Position mark and arrow, then make visible using rAF
        requestAnimationFrame(() => {
            if (!this.tourStarted || !this.currentMark) return; // Check state again in rAF

            this._positionMark(this.currentMark, this.currentTargetRect, this.currentStep); // Position the mark

            // Wait for mark positioning to apply before positioning arrow
            requestAnimationFrame(() => {
                if (!this.tourStarted || !this.currentMark) return;

                 this.currentMark.classList.add('visible'); // Fade in mark
                 this.circle.classList.add('visible');     // Fade in highlight circle

                if (this.currentStep.showArrow) {
                    this._positionArrow(this.currentMark, this.currentTargetRect); // Position arrow relative to mark
                    this.arrowEl.classList.add('visible'); // Fade in arrow
                } else {
                    this.arrowEl.innerHTML = '';
                    this.arrowEl.classList.remove('visible');
                }

                 // Focus the primary action button for accessibility
                 this.currentMark.querySelector('.coach-mark-button')?.focus();

                // Call onShowStep callback *after* everything is visible
                if (typeof this.options.onShowStep === 'function') {
                    try {
                        this.options.onShowStep(this.currentStep, targetElement);
                    } catch (e) {
                        console.error("Error in onShowStep callback:", e);
                    }
                }
            });
        });

        // Add button listeners
        mark.querySelector('.coach-mark-button').onclick = (e) => {
            e.stopPropagation();
            e.preventDefault();
            this.currentIndex++;
            this._showNext(); // Move to next step
        };
        mark.querySelector('.coach-mark-skip').onclick = (e) => {
            e.stopPropagation();
            e.preventDefault();
            this.endTour('skipped'); // End tour if skipped
        };
    }

    // --- Positioning Methods (_positionHighlight, _positionOverlay, _positionMark, _positionArrow, _createArrowSVG) ---
    // (These methods remain largely the same as in the previous version, with minor adjustments for rAF and checks)

    _positionHighlight(rect) {
      const padding = 4;
      const isWide = rect.width > rect.height * 1.5;
      const isTall = rect.height > rect.width * 1.5;
      let borderRadius;
       if (isWide) borderRadius = Math.min(rect.height / 2 + padding, 12);
       else if (isTall) borderRadius = Math.min(rect.width / 2 + padding, 8);
       else borderRadius = Math.min(Math.min(rect.width, rect.height) / 4 + padding, 8);

       requestAnimationFrame(() => { // Ensure updates happen in sync with rendering
           if (!this.tourStarted || !this.spotlight || !this.circle) return; // Check if tour active and elements exist

           this.spotlight.style.top = `${rect.top - padding}px`;
           this.spotlight.style.left = `${rect.left - padding}px`;
           this.spotlight.style.width = `${rect.width + padding * 2}px`;
           this.spotlight.style.height = `${rect.height + padding * 2}px`;
           this.spotlight.style.borderRadius = `${borderRadius}px`;

           const borderPadding = 3;
           this.circle.style.top = `${rect.top - padding - borderPadding}px`;
           this.circle.style.left = `${rect.left - padding - borderPadding}px`;
           this.circle.style.width = `${rect.width + padding * 2 + borderPadding * 2}px`;
           this.circle.style.height = `${rect.height + padding * 2 + borderPadding * 2}px`;
           this.circle.style.borderRadius = `${borderRadius + borderPadding}px`;
           // Opacity is controlled by adding/removing 'visible' class
       });
    }

    _positionOverlay(rect) {
        if (!this.currentOverlay) return;
         requestAnimationFrame(() => { // Use rAF for positioning
            if (!this.currentOverlay) return; // Check again in rAF
            this.currentOverlay.style.position = `absolute`; // Ensure position is set
            this.currentOverlay.style.top = `${rect.top}px`;
            this.currentOverlay.style.left = `${rect.left}px`;
            this.currentOverlay.style.width = `${rect.width}px`;
            this.currentOverlay.style.height = `${rect.height}px`;
            this.currentOverlay.style.zIndex = `${this.options.zIndexBase + 1}`;
            this.currentOverlay.style.background = `transparent`;
        });
    }

     _positionMark(mark, targetRect, step) {
       if (!mark || !targetRect) return;

       let markRect = mark.getBoundingClientRect();
        // If dimensions are 0, it might not be fully rendered yet, wait for next frame
       if (markRect.width === 0 || markRect.height === 0) {
            requestAnimationFrame(() => this._positionMark(mark, targetRect, step));
            return;
       }

       let top, left;
       const spacing = this.options.messageSpacing;
       const targetCenterX = targetRect.left + targetRect.width / 2;
       const targetCenterY = targetRect.top + targetRect.height / 2;
       const viewportWidth = window.innerWidth;
       const viewportHeight = window.innerHeight;
       const margin = 10; // Increased margin from viewport edge

       // --- Determine Optimal Position ---
       let position = step.position || 'below'; // Default
       const availableSpace = {
           above: targetRect.top - spacing - margin,
           below: viewportHeight - targetRect.bottom - spacing - margin,
           left: targetRect.left - spacing - margin,
           right: viewportWidth - targetRect.right - spacing - margin
       };

        // Special handling for search-like elements (prefer below/above)
       const isSearchElement = typeof step.target === 'string' && step.target.includes('search');
       if (isSearchElement && position !== 'center') {
            if (availableSpace.below >= markRect.height) position = 'below';
            else if (availableSpace.above >= markRect.height) position = 'above';
            else position = (availableSpace.left > availableSpace.right) ? 'left' : 'right'; // Side as fallback
       }
       // Adaptive logic for small screens or insufficient space
       else if (position !== 'center') {
            const requiredVSpace = markRect.height;
            const requiredHSpace = markRect.width;
            let currentPositionOK = false;

            switch (position) {
                case 'above': currentPositionOK = availableSpace.above >= requiredVSpace; break;
                case 'below': currentPositionOK = availableSpace.below >= requiredVSpace; break;
                case 'left': currentPositionOK = availableSpace.left >= requiredHSpace; break;
                case 'right': currentPositionOK = availableSpace.right >= requiredHSpace; break;
            }

            if (!currentPositionOK || (viewportWidth < 520)) { // Re-evaluate if preferred pos fails OR small screen
                 const sortedPositions = Object.entries(availableSpace)
                     .map(([pos, space]) => ({ pos, space }))
                     .sort((a, b) => b.space - a.space); // Sort by most space

                 let foundBetterPosition = false;
                 for (const { pos, space } of sortedPositions) {
                     if ((pos === 'above' || pos === 'below') && space >= requiredVSpace) {
                         position = pos; foundBetterPosition = true; break;
                     } else if ((pos === 'left' || pos === 'right') && space >= requiredHSpace) {
                         position = pos; foundBetterPosition = true; break;
                     }
                 }
                 // If no position has enough space, stick with original or default 'below'
                 if (!foundBetterPosition && !currentPositionOK) {
                      console.warn(`Insufficient space for coach mark. Using default '${position}'.`);
                 }
            }
       }
       // --- End Position Determination ---


        // Calculate initial top/left based on chosen position
        switch (position) {
            case 'above':
                top = targetRect.top - markRect.height - spacing;
                left = targetCenterX - markRect.width / 2;
                break;
            case 'below':
                top = targetRect.bottom + spacing;
                left = targetCenterX - markRect.width / 2;
                break;
            case 'left':
                top = targetCenterY - markRect.height / 2;
                left = targetRect.left - markRect.width - spacing;
                break;
            case 'right':
                top = targetCenterY - markRect.height / 2;
                left = targetRect.right + spacing;
                break;
            case 'center': // Center in viewport
                top = (viewportHeight - markRect.height) / 2;
                left = (viewportWidth - markRect.width) / 2;
                break;
            default: // Fallback
                position = 'below';
                top = targetRect.bottom + spacing;
                left = targetCenterX - markRect.width / 2;
                break;
        }

        // Apply offsets if provided
        if (step.offsetY) top += step.offsetY;
        if (step.offsetX) left += step.offsetX;

        // Use rAF to apply final constrained position
        requestAnimationFrame(() => {
            if (!mark) return; // Check element exists in rAF
            // Re-get rect in case offsets changed size significantly (unlikely but safe)
            const finalMarkRect = mark.getBoundingClientRect();

            // Ensure the mark stays within viewport bounds
            top = Math.max(margin, Math.min(top, viewportHeight - finalMarkRect.height - margin));
            left = Math.max(margin, Math.min(left, viewportWidth - finalMarkRect.width - margin));

            mark.style.top = `${top}px`;
            mark.style.left = `${left}px`;
            mark.dataset.finalPosition = position; // Store final position for arrow logic
        });
    }

    _positionArrow(mark, targetRect) {
        if (!this.arrowEl || !mark || !targetRect) return;

        requestAnimationFrame(() => { // Ensure positioning happens smoothly
             if (!this.arrowEl || !mark || !mark.dataset.finalPosition || !targetRect) return;

             const markRect = mark.getBoundingClientRect();
             if (markRect.width === 0 || markRect.height === 0) return; // Mark not rendered

             const position = mark.dataset.finalPosition; // Use stored final position

             // Calculate arrow start point (from edge of mark)
             let fromX, fromY;
             const arrowMargin = 2; // Small gap between mark and arrow start
             switch (position) {
                case 'left':
                    fromX = markRect.right - arrowMargin;
                    fromY = markRect.top + markRect.height / 2;
                    break;
                case 'right':
                    fromX = markRect.left + arrowMargin;
                    fromY = markRect.top + markRect.height / 2;
                    break;
                case 'above':
                    fromX = markRect.left + markRect.width / 2;
                    fromY = markRect.bottom - arrowMargin;
                    break;
                case 'below':
                default:
                    fromX = markRect.left + markRect.width / 2;
                    fromY = markRect.top + arrowMargin;
                    break;
             }

             // Calculate arrow end point (center of target)
             const toX = targetRect.left + targetRect.width / 2;
             const toY = targetRect.top + targetRect.height / 2;

             // Prevent drawing if points are identical
             if (Math.abs(fromX - toX) < 1 && Math.abs(fromY - toY) < 1) {
                 this.arrowEl.innerHTML = ''; // Clear if too close
                 return;
             }

             const svg = this._createArrowSVG(fromX, fromY, toX, toY);
             this.arrowEl.innerHTML = ''; // Clear previous
             this.arrowEl.appendChild(svg);
        });
    }

    _createArrowSVG(x1, y1, x2, y2) {
      const ns = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(ns, "svg");
      // Use 100% width/height and rely on coordinates within viewbox
      svg.setAttribute("viewBox", `0 0 ${window.innerWidth} ${window.innerHeight}`);
      svg.style.position = "absolute";
      svg.style.top = "0"; svg.style.left = "0";
      svg.style.width = "100%"; svg.style.height = "100%";
      svg.style.pointerEvents = "none";

      const defs = document.createElementNS(ns, "defs");
      const marker = document.createElementNS(ns, "marker");
      marker.setAttribute("id", "coachmark-arrowhead"); // More specific ID
      marker.setAttribute("markerWidth", "8"); marker.setAttribute("markerHeight", "6");
      marker.setAttribute("refX", "7"); marker.setAttribute("refY", "3");
      marker.setAttribute("orient", "auto-start-reverse");

      const polygon = document.createElementNS(ns, "polygon");
      polygon.setAttribute("points", "0 0, 8 3, 0 6");
      polygon.setAttribute("fill", "white");
      marker.appendChild(polygon);
      defs.appendChild(marker);
      svg.appendChild(defs);

      const path = document.createElementNS(ns, "path");
      const dx = x2 - x1, dy = y2 - y1;
      // Adjust curve intensity based on distance? Keep simple for now.
      const controlX = x1 + dx / 2 + dy * 0.1; // Gentle curve control points
      const controlY = y1 + dy / 2 - dx * 0.1;
      path.setAttribute("d", `M ${x1} ${y1} Q ${controlX} ${controlY}, ${x2} ${y2}`);
      path.setAttribute("stroke", "white");
      path.setAttribute("stroke-width", "1.5");
      path.setAttribute("fill", "none");
      path.setAttribute("stroke-dasharray", "4, 3");
      path.setAttribute("marker-end", "url(#coachmark-arrowhead)"); // Use specific ID

      // Set initial dash offset for animation
      // Need path in DOM to calculate length correctly
      requestAnimationFrame(() => {
          if (!path || !path.parentNode) return; // Check if path is still valid
          try {
              const length = path.getTotalLength();
              path.style.strokeDashoffset = length;
              // Trigger animation by setting style - relies on CSS animation defined earlier
          } catch(e) {
              console.warn("Could not get path length for animation.", e);
              path.style.strokeDashoffset = 1000; // Fallback
          }
      });

      svg.appendChild(path);
      return svg;
    }


    // --- Event Handlers (_handleResize, _handleKeydown) & Utilities (_isElementVisible) ---
    // (These methods remain largely the same as in the previous version, with minor robustness checks)

    _handleResize() {
        if (!this.tourStarted || !this.currentStep || !this.currentMark || !this.container) return;

        let targetElement;
        try {
            if (typeof this.currentStep.target === 'function') {
                targetElement = this.currentStep.target();
            } else {
                targetElement = document.querySelector(this.currentStep.target);
            }
        } catch (e) { targetElement = null; }


        if (!targetElement || !this._isElementVisible(targetElement)) {
            console.warn("Target lost during resize:", typeof this.currentStep.target === 'string' ? this.currentStep.target : '[Function]');
             // Set timeout to end tour if target doesn't reappear
             if (this._endTourTimeout) clearTimeout(this._endTourTimeout);
             this._endTourTimeout = setTimeout(() => {
                 if (!this.tourStarted) return; // Check if tour ended in the meantime

                 let currentTargetCheck;
                 try {
                     currentTargetCheck = typeof this.currentStep?.target === 'function' ? this.currentStep.target() : document.querySelector(this.currentStep?.target);
                 } catch(e){ currentTargetCheck = null; }

                 if (!currentTargetCheck || !this._isElementVisible(currentTargetCheck)) {
                    console.warn("Target still missing after resize timeout. Ending tour.");
                    this.endTour('skipped'); // End gracefully if target is gone
                 }
             }, 1500); // Time to allow layout shifts to settle
            return;
        }
        // If target is found again, clear the end timeout
        if (this._endTourTimeout) clearTimeout(this._endTourTimeout);


        this.currentTargetRect = targetElement.getBoundingClientRect();
        // Use rAF for all repositioning during resize for smoothness
        requestAnimationFrame(() => {
            if (!this.tourStarted || !this.currentMark || !this.container) return; // Re-check state in rAF
            this._positionHighlight(this.currentTargetRect);
            this._positionMark(this.currentMark, this.currentTargetRect, this.currentStep);
            if(this.currentOverlay) this._positionOverlay(this.currentTargetRect);
            if (this.currentStep.showArrow) {
                 // Re-position arrow after mark position is updated
                this._positionArrow(this.currentMark, this.currentTargetRect);
            }
        });
    }

    _handleKeydown(event) {
        if (!this.container || !this.currentMark) return; // Ensure elements exist

         // Allow default behavior if focus is inside an input within the coach mark (if any were added)
         if (event.target.tagName === 'INPUT' && this.currentMark.contains(event.target) && event.key !== 'Escape') {
             return;
         }

         if (event.key === 'Escape') {
             event.preventDefault();
             this.endTour('skipped');
         } else if (event.key === 'Enter' || event.key === ' ') {
             // Check if the focused element is one of the tour buttons
             if (event.target.classList.contains('coach-mark-button') || event.target.classList.contains('coach-mark-skip')) {
                 return; // Allow default button activation
             }
             // Otherwise, activate the primary button ('Next'/'Done'/'Start')
             event.preventDefault();
             const button = this.currentMark.querySelector('.coach-mark-button');
             button?.click();

         } else if (event.key === 'ArrowRight' && this.tourStarted && !isFinalStep) {
             event.preventDefault();
             const nextButton = this.currentMark.querySelector('.coach-mark-button');
             nextButton?.click();
         }
         // Potential: Add ArrowLeft for 'Back' button if implemented
    }

    _isElementVisible(el) {
       if (!el || !document.body.contains(el)) return false;

       const style = window.getComputedStyle(el);
       if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0' || style.pointerEvents === 'none') {
           return false;
       }

       const rect = el.getBoundingClientRect();
       // Check for valid dimensions AND position (non-zero width/height is crucial)
       if (rect.width <= 0 || rect.height <= 0) {
            return false;
       }

       // Check if *center* of element is within viewport bounds (stricter check)
       const elemCenterX = rect.left + rect.width / 2;
       const elemCenterY = rect.top + rect.height / 2;
       const isInViewport = (
           elemCenterX > 0 && elemCenterX < window.innerWidth &&
           elemCenterY > 0 && elemCenterY < window.innerHeight
       );

        // Also check if at least partially visible using the previous method for edge cases
        const partiallyVisible = (
            rect.top < window.innerHeight && rect.bottom > 0 &&
            rect.left < window.innerWidth && rect.right > 0
        );

       // Check if element is practically hidden by an overlay (basic check)
       // Note: This is hard to do perfectly without knowing all elements on the page
       // let elementAtCenter = document.elementFromPoint(elemCenterX, elemCenterY);
       // let isObscured = !(elementAtCenter === el || el.contains(elementAtCenter));


       return (isInViewport || partiallyVisible) && el.offsetParent !== null; // Ensure it's in the layout flow
    }
  } // --- End of CoachMarkTour Class ---


  // --- Configuration and Initialization ---
  const tourSteps = [
    { target: '.filter-button', text: 'Use filters to narrow down your choices based on preferences.', position: 'below', showArrow: true },
    { target: '.search-container input', text: 'Looking for something specific? Type it here.', position: 'below', showArrow: true },
    { target: '.category-btn:nth-child(2)', text: 'Quickly jump between different food categories.', position: 'below', showArrow: true },
    { target: '.view-all', text: 'See all items in the current category or search results.', position: 'above', showArrow: true, offsetY: -5 },
    {
        target: '.items-carousel',
        text: 'Swipe or scroll this section horizontally to discover more dishes.',
        position: 'center',
        showArrow: false,
        carouselItem: false // Targets the container
    },
    {
        // Example using a function target - finds the *last* visible item
        target: () => {
            const items = document.querySelectorAll('.items-carousel .food-item');
            // Find the last item fully visible in the carousel viewport
            const carousel = document.querySelector('.items-carousel');
            if (!carousel) return items[items.length -1]; // Fallback
            const carouselRect = carousel.getBoundingClientRect();
            for (let i = items.length - 1; i >= 0; i--) {
                const itemRect = items[i].getBoundingClientRect();
                 if (itemRect.right <= carouselRect.right + 5 && itemRect.left >= carouselRect.left -5) {
                      return items[i]; // Return last mostly visible item
                 }
            }
            return items[items.length -1]; // Fallback to last item overall
        },
        text: 'Tap any item like this one to view details and add it to your order.',
        position: 'above',
        showArrow: true,
        carouselItem: true // Indicates it's inside a carousel for scroll handling
    }
  ];

  const menuTour = new CoachMarkTour(tourSteps, {
    initialDelay: 700,
    // maxWidth: 210, // Inherited from class defaults
    // messageSpacing: 10, // Inherited from class defaults
    persistenceKey: 'menuTourCompleted_v1.2', // Use a unique key!
    onShowStep: (step, element) => {
        console.log(`Showing step for: ${ typeof step.target === 'function' ? '[Function]' : step.target}`, element);
        // Add a subtle highlight class to the target element itself
        element?.classList.add('coach-mark-target-highlight');
    },
    onEndTour: (status) => {
        console.log(`Tour ended with status: ${status}`);
        // Clean up any highlight classes added by onShowStep
        document.querySelectorAll('.coach-mark-target-highlight').forEach(el => {
            el.classList.remove('coach-mark-target-highlight');
        });
        if (status === 'completed') {
            console.log("User completed the tour successfully!");
        }
    }
  });

  // --- Add Test Elements if they don't exist ---
  const contentArea = document.getElementById('app-content');
  if (contentArea && !contentArea.querySelector('.filter-button')) {
    console.log("Adding test elements for demo...");
    const testContainer = document.createElement('div');
    testContainer.className = 'test-elements-container'; // Use class for styling
    testContainer.innerHTML = `
      <h2>Menu Demo</h2>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 10px; flex-wrap: wrap;">
        <button class="filter-button" style="padding: 8px 14px; background: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; cursor: pointer;">Filter <span style="font-size: 0.8em;">▼</span></button>
        <div class="search-container" style="flex-grow: 1; min-width: 150px;">
          <input type="search" placeholder="Search dishes..." style="width: 100%; padding: 9px 12px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box;">
        </div>
      </div>
      <div style="display: flex; overflow-x: auto; margin-bottom: 20px; padding-bottom: 10px; gap: 10px; border-bottom: 1px solid #eee;">
        <button class="category-btn" style="flex-shrink: 0; padding: 8px 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer;">Appetizers</button>
        <button class="category-btn" style="flex-shrink: 0; padding: 8px 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer;">Main Courses</button>
        <button class="category-btn" style="flex-shrink: 0; padding: 8px 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer;">Desserts</button>
        <button class="category-btn" style="flex-shrink: 0; padding: 8px 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer;">Drinks</button>
      </div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; font-size: 1.1em; color: #495057;">Popular Items</h3>
        <a href="#" class="view-all" style="text-decoration: none; color: #007bff; font-size: 0.9em; font-weight: 500;">View All</a>
      </div>
      <div class="items-carousel" style="display: flex; overflow-x: auto; padding: 10px 5px 15px 5px; margin: 0 -5px; scroll-snap-type: x mandatory; gap: 15px;">
        <div class="food-item" style="scroll-snap-align: start; flex: 0 0 160px; border: 1px solid #eee; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); overflow: hidden; cursor: pointer;">
          <div style="height: 100px; background: #e9ecef; display:flex; align-items: center; justify-content: center; color: #adb5bd;">Image</div>
          <div style="padding: 10px;">
             <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px;">Pizza Slice</div>
             <div style="color: #6c757d; font-size: 0.85em;">$3.99</div>
          </div>
        </div>
        <div class="food-item" style="scroll-snap-align: start; flex: 0 0 160px; border: 1px solid #eee; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); overflow: hidden; cursor: pointer;">
           <div style="height: 100px; background: #e9ecef; display:flex; align-items: center; justify-content: center; color: #adb5bd;">Image</div>
           <div style="padding: 10px;">
             <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px;">Burger Combo</div>
             <div style="color: #6c757d; font-size: 0.85em;">$11.50</div>
           </div>
        </div>
        <div class="food-item" style="scroll-snap-align: start; flex: 0 0 160px; border: 1px solid #eee; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); overflow: hidden; cursor: pointer;">
           <div style="height: 100px; background: #e9ecef; display:flex; align-items: center; justify-content: center; color: #adb5bd;">Image</div>
           <div style="padding: 10px;">
             <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px;">Salad Bowl</div>
             <div style="color: #6c757d; font-size: 0.85em;">$8.75</div>
           </div>
        </div>
         <div class="food-item" style="scroll-snap-align: start; flex: 0 0 160px; border: 1px solid #eee; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); overflow: hidden; cursor: pointer;">
            <div style="height: 100px; background: #e9ecef; display:flex; align-items: center; justify-content: center; color: #adb5bd;">Image</div>
            <div style="padding: 10px;">
             <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px;">Pasta Dish</div>
             <div style="color: #6c757d; font-size: 0.85em;">$12.00</div>
           </div>
        </div>
         <div class="food-item" style="scroll-snap-align: start; flex: 0 0 160px; border: 1px solid #eee; border-radius: 8px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); overflow: hidden; cursor: pointer;">
            <div style="height: 100px; background: #e9ecef; display:flex; align-items: center; justify-content: center; color: #adb5bd;">Image</div>
            <div style="padding: 10px;">
             <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 4px;">Ice Cream</div>
             <div style="color: #6c757d; font-size: 0.85em;">$4.50</div>
            </div>
        </div>
      </div>
    `;
    contentArea.appendChild(testContainer);
  } else if (!contentArea) {
      console.error("Could not find #app-content element to inject test HTML.");
  }

  // Start the tour after setup
  menuTour.start();

  // --- Optional: Add a way to reset for testing during development ---
  // You could add a button or console command to call menuTour.resetTourState()
  // Example: window.resetMenuTour = () => menuTour.resetTourState();

});
</script> -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        if (img.dataset.src) {
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
        }
        if (img.dataset.srcset) {
          img.srcset = img.dataset.srcset;
          img.removeAttribute('data-srcset');
        }
        img.onload = () => img.classList.add('loaded');
        observer.unobserve(img);
      }
    });
  }, { rootMargin: '0px 0px 200px 0px', threshold: 0.01 });

  document.querySelectorAll('.main-image').forEach(img => observer.observe(img));

  // Preload first 3 images
  const firstImages = Array.from(document.querySelectorAll('.food-item')).slice(0,3);
  firstImages.forEach(item => {
    const img = item.querySelector('.main-image');
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = img.dataset.src;
    if (img.dataset.srcset) link.imagesrcset = img.dataset.srcset;
    document.head.appendChild(link);
  });
});
</script>





 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Script to show the modal on page load and handle form submission -->
   </body>
</html>
